<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>ReactNative集成到现有原生项目、拆包、热更新 | MIFind With Daria.</title>
  <meta name="author" content="MIFind">
  
  <meta name="description" content="永远相信美好的事情即将发生 —— Always believe that good things are about to happen.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="ReactNative集成到现有原生项目、拆包、热更新"/>
  <meta property="og:site_name" content="MIFind With Daria."/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 4.2.1"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">MIFind With Daria.</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/us" title="About us.">
			  <i class=""></i>Us
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> ReactNative集成到现有原生项目、拆包、热更新</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="ReactNative-集成到现有原生项目、拆包、热更新"><a href="#ReactNative-集成到现有原生项目、拆包、热更新" class="headerlink" title="ReactNative 集成到现有原生项目、拆包、热更新"></a>ReactNative 集成到现有原生项目、拆包、热更新</h1><hr>
<p>如果你正准备从头开始制作一个新的应用，那么 React Native 会是个非常好的选择。但是大多数项目我们已经有一个原生应用，React Native 作为业务 module，集成到原生应用中。我们一个应用中可能有很多 RN 业务模块，那 module 拆包、热更新就尤为重要。</p>
<h2 id="集成到现有原生项目"><a href="#集成到现有原生项目" class="headerlink" title="集成到现有原生项目"></a>集成到现有原生项目</h2><h3 id="集成到原生项目，首先要安装-RN-开发环境。"><a href="#集成到原生项目，首先要安装-RN-开发环境。" class="headerlink" title="集成到原生项目，首先要安装 RN 开发环境。"></a>集成到原生项目，首先要安装 RN 开发环境。</h3><ol>
<li><a href="https://reactnative.cn/docs/getting-started.html" target="_blank" rel="noopener">搭建 RN 开发环境</a></li>
<li>由于是集成到现有原生项目，不需要 init 一个新的 RN 项目。<ol>
<li>获取 RN 项目库，并执行<code>npm install</code>，安装 RN 项目所需要依赖。</li>
<li>如果没有 RN 项目库，需要同步当前需要集成的 RN 项目的 package.json，并执行<code>npm install</code></li>
</ol>
</li>
</ol>
<h3 id="1-Android"><a href="#1-Android" class="headerlink" title="1 Android"></a>1 Android</h3><h4 id="1-project-gradle-添加配置"><a href="#1-project-gradle-添加配置" class="headerlink" title="1. project gradle 添加配置"></a>1. project gradle 添加配置</h4><p>在项目的 build.gradle 文件中为 React Native 添加一个 maven 依赖的入口，必须写在 “allprojects” 代码块中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">         &#x2F;&#x2F;rn</span><br><span class="line">        maven &#123;</span><br><span class="line">            url &quot;$rootDir&#x2F;..&#x2F;node_modules&#x2F;react-native&#x2F;android&quot;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url(&quot;$rootDir&#x2F;..&#x2F;node_modules&#x2F;jsc-android&#x2F;dist&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;qtt maven-&gt; codepush</span><br><span class="line">         maven &#123;</span><br><span class="line">            url &quot;http:&#x2F;&#x2F;nexus.qutoutiao.net&#x2F;repository&#x2F;android&#x2F;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;rn end</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-app-gradle-添加配置"><a href="#2-app-gradle-添加配置" class="headerlink" title="2. app gradle 添加配置"></a>2. app gradle 添加配置</h4><p>在 app 中 build.gradle 文件中添加 React Native 依赖:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;rn</span><br><span class="line">project.ext.react &#x3D; [</span><br><span class="line">        entryFile: &quot;index.js&quot;,</span><br><span class="line">        enableHermes: false,  &#x2F;&#x2F; clean and rebuild if changing</span><br><span class="line">        jsBundleDirRelease: &quot;$buildDir&#x2F;intermediates&#x2F;merged_assets&#x2F;release&#x2F;out&#x2F;index&quot;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">apply from: &quot;..&#x2F;..&#x2F;node_modules&#x2F;react-native&#x2F;react.gradle&quot;</span><br><span class="line"></span><br><span class="line">def enableHermes &#x3D; project.ext.react.get(&quot;enableHermes&quot;, false);</span><br><span class="line"></span><br><span class="line">def jscFlavor &#x3D; &#39;org.webkit:android-jsc:+&#39;</span><br><span class="line"></span><br><span class="line">def safeExtGet(prop, fallback) &#123;</span><br><span class="line">    rootProject.ext.has(prop) ? rootProject.ext.get(prop) : fallback</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;rn end</span><br></pre></td></tr></table></figure>

<p>添加 gradle 依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;rn</span><br><span class="line">    if (enableHermes) &#123;</span><br><span class="line">        def hermesPath &#x3D; &quot;..&#x2F;..&#x2F;node_modules&#x2F;hermesvm&#x2F;android&#x2F;&quot;;</span><br><span class="line">        debugImplementation files(hermesPath + &quot;hermes-debug.aar&quot;)</span><br><span class="line">        releaseImplementation files(hermesPath + &quot;hermes-release.aar&quot;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        implementation jscFlavor</span><br><span class="line">    &#125;</span><br><span class="line">    implementation &quot;com.facebook.react:react-native:+&quot; &#x2F;&#x2F; From node_modules</span><br><span class="line">    implementation &quot;androidx.swiperefreshlayout:swiperefreshlayout:1.0.0&quot;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 这里使用手动引入依赖，所以要手动添加。如果auto-link这里不用引用。</span><br><span class="line">    implementation project(&#39;:@react-native-community_masked-view&#39;)</span><br><span class="line">    implementation project(&#39;:react-native-gesture-handler&#39;)</span><br><span class="line">    implementation project(&#39;:react-native-reanimated&#39;)</span><br><span class="line">    implementation project(&#39;:react-native-safe-area-context&#39;)</span><br><span class="line">    implementation project(&#39;:react-native-screens&#39;)</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; --&gt; codepush</span><br><span class="line">    implementation project(&#39;:@innotechx_react-native-code-push&#39;)</span><br><span class="line">    &#x2F;&#x2F;rn end</span><br></pre></td></tr></table></figure>

<p>最下面添加 codepush 引用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply from: file(&quot;..&#x2F;..&#x2F;node_modules&#x2F;@innotechx&#x2F;react-native-code-push&#x2F;android&#x2F;codepush.gradle&quot;)</span><br></pre></td></tr></table></figure>

<p>注意确认 node_modules 所在的目录位置。</p>
<h4 id="3-settings-gradle-添加配置"><a href="#3-settings-gradle-添加配置" class="headerlink" title="3. settings.gradle 添加配置"></a>3. settings.gradle 添加配置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">include &#39;:@innotechx_react-native-code-push&#39;</span><br><span class="line">project(&#39;:@innotechx_react-native-code-push&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;@innotechx&#x2F;react-native-code-push&#x2F;android&#x2F;app&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:react-native-gesture-handler&#39;</span><br><span class="line">project(&#39;:react-native-gesture-handler&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;react-native-gesture-handler&#x2F;android&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:react-native-reanimated&#39;</span><br><span class="line">project(&#39;:react-native-reanimated&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;react-native-reanimated&#x2F;android&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:react-native-safe-area-context&#39;</span><br><span class="line">project(&#39;:react-native-safe-area-context&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;react-native-safe-area-context&#x2F;android&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:react-native-screens&#39;</span><br><span class="line">project(&#39;:react-native-screens&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;react-native-screens&#x2F;android&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:@react-native-community_masked-view&#39;</span><br><span class="line">project(&#39;:@react-native-community_masked-view&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;@react-native-community&#x2F;masked-view&#x2F;android&#39;)</span><br></pre></td></tr></table></figure>

<h4 id="4-AndroidManifest-xml"><a href="#4-AndroidManifest-xml" class="headerlink" title="4. AndroidManifest.xml"></a>4. AndroidManifest.xml</h4><p>1 声明网络权限<br><br><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code></p>
<p>2 添加开发者菜单<br><br><code>&lt;activity android:name=&quot;com.facebook.react.devsupport.DevSettingsActivity&quot; /&gt;</code></p>
<p>3 network_security_config.xml(API level 28+)<br></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">  android:networkSecurityConfig&#x3D;&quot;@xml&#x2F;network_security_config&quot;&gt;</span><br><span class="line">&lt;&#x2F;application&gt;</span><br></pre></td></tr></table></figure>

<p>在<code>/res/xml</code>中添加<code>network_security_config.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;network-security-config&gt;</span><br><span class="line">    &lt;base-config cleartextTrafficPermitted&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;network-security-config&gt;</span><br></pre></td></tr></table></figure>

<h4 id="4-将兜底包放到-assets-目录下"><a href="#4-将兜底包放到-assets-目录下" class="headerlink" title="4. 将兜底包放到 assets 目录下"></a>4. 将兜底包放到 assets 目录下</h4><h4 id="5-根据-demo-改造原生代码"><a href="#5-根据-demo-改造原生代码" class="headerlink" title="5. 根据 demo 改造原生代码"></a>5. 根据 demo 改造原生代码</h4><p>主要为加载 bundle、拆包、热更新的相关实现。</p>
<ul>
<li>JsLoaderUtil</li>
<li>BaseReactActivity</li>
<li>SpConfig</li>
</ul>
<p>对 Application 的改造: 继承 ReactApplication。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class MainApplication extends Application implements ReactApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static Application app;</span><br><span class="line"></span><br><span class="line">    private SpConfig sc;</span><br><span class="line"></span><br><span class="line">    private final ReactNativeHost mReactNativeHost &#x3D; new ReactNativeHost(this) &#123;</span><br><span class="line"></span><br><span class="line">        private String moduleId &#x3D; &quot;basic&quot;;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean getUseDeveloperSupport() &#123;</span><br><span class="line">            JsLoaderUtil.jsState.isDev &#x3D; sc.getLoadRuntime();</span><br><span class="line">            return sc.getLoadRuntime();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        protected List&lt;ReactPackage&gt; getPackages() &#123;</span><br><span class="line">        	&#x2F;&#x2F; 这里要添加进去RNPackage</span><br><span class="line">            return new ArrayList&lt;&gt;(Arrays.&lt;ReactPackage&gt;asList(</span><br><span class="line">                    new MainReactPackage(),</span><br><span class="line">                    new RNCMaskedViewPackage(),</span><br><span class="line">                    new RNGestureHandlerPackage(),</span><br><span class="line">                    new ReanimatedPackage(),</span><br><span class="line">                    new SafeAreaContextPackage(),</span><br><span class="line">                    new RNScreensPackage(),</span><br><span class="line">                    new CodePush(&quot;Xzy1V0cWXWDuh7Bb7HogAraIAJLT4c266bc0c0&quot;, MainApplication.this, this.moduleId, BuildConfig.DEBUG, &quot;http:&#x2F;&#x2F;code-push-server.qutoutiao.net&#x2F;&quot;)</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Nullable</span><br><span class="line">        @Override</span><br><span class="line">        protected String getJSBundleFile() &#123;</span><br><span class="line">            return CodePush.getJSBundleFile(this.moduleId, &quot;basic.android.bundle&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Nullable</span><br><span class="line">        @Override</span><br><span class="line">        protected String getBundleAssetName() &#123;</span><br><span class="line">            return &quot;basic&#x2F;basic.android.bundle&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        protected String getJSMainModuleName() &#123;</span><br><span class="line">            return &quot;index&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ReactNativeHost getReactNativeHost() &#123;</span><br><span class="line">        return mReactNativeHost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line">        sc &#x3D; new SpConfig(this);</span><br><span class="line">        app &#x3D; this;</span><br><span class="line">        SoLoader.init(this, &#x2F;* native exopackage *&#x2F; false);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当前实现是基于基类<code>BaseReactActivity</code>，这样加载 RN module 的业务组件只需要继承<code>BaseReactActivity</code>即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Business1Activity extends BaseReactActivity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected String getBundleName() &#123;</span><br><span class="line">        return &quot;act_618.android.bundle&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    @Override</span><br><span class="line">    protected String getMainComponentName() &#123;</span><br><span class="line">        return &quot;act_618&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected String getModuleId() &#123;</span><br><span class="line">        return &quot;buz_act_618&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>： 如果 Android 项目的根目录名就是 android，才可以使用自动引用，就不需要 settings.gradle 与 app build.gradle 里做手动引用依赖，相应的 MainApplication 的 add package 也需要修改。</p>
<p><strong>CodePush 相关</strong>：<a href="https://developer.qutoutiao.net/wiki/#/8/README?id=android" target="_blank" rel="noopener">相关配置参考</a></p>
<h3 id="2-IOS"><a href="#2-IOS" class="headerlink" title="2 IOS"></a>2 IOS</h3><h4 id="1-Podfile-修改"><a href="#1-Podfile-修改" class="headerlink" title="1. Podfile 修改"></a>1. Podfile 修改</h4><p>将以下 Podfile 内容配置到你的 Podfile 文件里，<code>pod install</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">platform :ios, &#39;9.0&#39;</span><br><span class="line">require_relative &#39;..&#x2F;node_modules&#x2F;@react-native-community&#x2F;cli-platform-ios&#x2F;native_modules&#39;</span><br><span class="line"></span><br><span class="line"># target的名字一般与你的项目名字相同</span><br><span class="line">target &#39;reactnative_multibundler&#39; do</span><br><span class="line"></span><br><span class="line">  # &#39;node_modules&#39;目录一般位于根目录中</span><br><span class="line">  # 但是如果你的结构不同，那你就要根据实际路径修改下面的&#96;:path&#96;</span><br><span class="line">  pod &#39;FBLazyVector&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;FBLazyVector&quot;</span><br><span class="line">  pod &#39;FBReactNativeSpec&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;FBReactNativeSpec&quot;</span><br><span class="line">  pod &#39;RCTRequired&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;RCTRequired&quot;</span><br><span class="line">  pod &#39;RCTTypeSafety&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;TypeSafety&quot;</span><br><span class="line">  pod &#39;React&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;&#39;</span><br><span class="line">  pod &#39;React-Core&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;&#39;</span><br><span class="line">  pod &#39;React-CoreModules&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;React&#x2F;CoreModules&#39;</span><br><span class="line">  pod &#39;React-Core&#x2F;DevSupport&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;&#39;</span><br><span class="line">  pod &#39;React-RCTActionSheet&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;ActionSheetIOS&#39;</span><br><span class="line">  pod &#39;React-RCTAnimation&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;NativeAnimation&#39;</span><br><span class="line">  pod &#39;React-RCTBlob&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Blob&#39;</span><br><span class="line">  pod &#39;React-RCTImage&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Image&#39;</span><br><span class="line">  pod &#39;React-RCTLinking&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;LinkingIOS&#39;</span><br><span class="line">  pod &#39;React-RCTNetwork&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Network&#39;</span><br><span class="line">  pod &#39;React-RCTSettings&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Settings&#39;</span><br><span class="line">  pod &#39;React-RCTText&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Text&#39;</span><br><span class="line">  pod &#39;React-RCTVibration&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Vibration&#39;</span><br><span class="line">  pod &#39;React-Core&#x2F;RCTWebSocket&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;&#39;</span><br><span class="line"></span><br><span class="line">  pod &#39;React-cxxreact&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;cxxreact&#39;</span><br><span class="line">  pod &#39;React-jsi&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;jsi&#39;</span><br><span class="line">  pod &#39;React-jsiexecutor&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;jsiexecutor&#39;</span><br><span class="line">  pod &#39;React-jsinspector&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;jsinspector&#39;</span><br><span class="line">  pod &#39;ReactCommon&#x2F;jscallinvoker&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&quot;</span><br><span class="line">  pod &#39;ReactCommon&#x2F;turbomodule&#x2F;core&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&quot;</span><br><span class="line">  pod &#39;Yoga&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;yoga&#39;</span><br><span class="line"></span><br><span class="line">  pod &#39;DoubleConversion&#39;, :podspec &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;third-party-podspecs&#x2F;DoubleConversion.podspec&#39;</span><br><span class="line">  pod &#39;glog&#39;, :podspec &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;third-party-podspecs&#x2F;glog.podspec&#39;</span><br><span class="line">  pod &#39;Folly&#39;, :podspec &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;third-party-podspecs&#x2F;Folly.podspec&#39;</span><br><span class="line"></span><br><span class="line">  pod &#39;CodePush&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;@innotechx&#x2F;react-native-code-push&#39;</span><br><span class="line"></span><br><span class="line">  pod &#39;SSZipArchive&#39;</span><br><span class="line"></span><br><span class="line">  use_native_modules!</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<h4 id="2-将兜底包放到项目里"><a href="#2-将兜底包放到项目里" class="headerlink" title="2. 将兜底包放到项目里"></a>2. 将兜底包放到项目里</h4><h4 id="3-根据-demo-改造原生代码"><a href="#3-根据-demo-改造原生代码" class="headerlink" title="3. 根据 demo 改造原生代码"></a>3. 根据 demo 改造原生代码</h4><p>主要为加载 bundle、拆包、热更新的相关实现。</p>
<ul>
<li>ScriptLoadUtil</li>
<li>ReactController</li>
<li>RctBridge</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1、暴露RCTBridge的executeSourceCode方法，做法为将本项目中的RCTBridge添加到自己的工程</span><br><span class="line"></span><br><span class="line">2、事先加载基础包：</span><br><span class="line"></span><br><span class="line">jsCodeLocation &#x3D; [[NSBundle mainBundle] URLForResource:@&quot;platform.ios&quot; withExtension:@&quot;bundle&quot;];</span><br><span class="line">bridge &#x3D; [[RCTBridge alloc] initWithBundleURL:jsCodeLocation</span><br><span class="line">                             moduleProvider:nil</span><br><span class="line">                              launchOptions:launchOptions];</span><br><span class="line"></span><br><span class="line">3、加载业务包：</span><br><span class="line"></span><br><span class="line">NSURL *jsCodeLocationBuz &#x3D; [[NSBundle mainBundle] URLForResource:bundleName withExtension:@&quot;bundle&quot;];</span><br><span class="line">  NSError *error &#x3D; nil;</span><br><span class="line">  NSData *sourceBuz &#x3D; [NSData dataWithContentsOfFile:jsCodeLocationBuz.path</span><br><span class="line">                                         options:NSDataReadingMappedIfSafe</span><br><span class="line">                                           error:&amp;error];</span><br><span class="line">  [bridge.batchedBridge executeSourceCode:sourceBuz sync:NO];</span><br><span class="line"></span><br><span class="line">4、创建RCTRootView，并绑定业务代码</span><br><span class="line"></span><br><span class="line">RCTRootView* view &#x3D; [[RCTRootView alloc] initWithBridge:bridge moduleName:moduleName initialProperties:nil];</span><br></pre></td></tr></table></figure>

<p><strong>CodePush 相关</strong>：<a href="https://developer.qutoutiao.net/wiki/#/8/README?id=ios" target="_blank" rel="noopener">相关配置参考</a></p>
<hr>
<h2 id="ReactNative-拆包与多业务开发"><a href="#ReactNative-拆包与多业务开发" class="headerlink" title="ReactNative 拆包与多业务开发"></a>ReactNative 拆包与多业务开发</h2><ol>
<li><p>创建业务<br><br><code>npm run create</code>会在<code>/src/modules</code>里创建业务模块。</p>
</li>
<li><p>开发与 debug<br><br><code>npm run start</code>开启 metro packager，然后在集成好的 Native 项目查看效果（或者打开 RNHybrid Demo 查看效果）</p>
</li>
<li><p>打包<br><br>通过<code>npm run bundler</code>打包基础包与业务包。 1. 基础包配置<br></p>
</li>
</ol>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">基础包入口 - basic.js</span><br><span class="line">import React from &#39;react&#39;</span><br><span class="line">import &#123; Text &#125; from &#39;react-native&#39;</span><br><span class="line">import &#39;react-native&#39;</span><br><span class="line">import &#39;mobx&#39;</span><br><span class="line">import &#39;mobx-react&#39;</span><br><span class="line">import &#39;mobx-react-lite&#39;</span><br><span class="line">import &#39;react-native-gesture-handler&#39;</span><br><span class="line">import &#39;react-native-safe-area-context&#39;</span><br><span class="line">import &#39;react-native-reanimated&#39;</span><br><span class="line">import &#39;react-native-screens&#39;</span><br><span class="line"></span><br><span class="line">import &#39;@innotechx&#x2F;react-native-code-push&#39;</span><br><span class="line"></span><br><span class="line">import &#39;@react-native-community&#x2F;masked-view&#39;</span><br><span class="line">import &#39;@react-navigation&#x2F;stack&#39;</span><br><span class="line">import &#39;@react-navigation&#x2F;native&#39;</span><br><span class="line"></span><br><span class="line">const wrap &#x3D; require(&#39;lodash.wrap&#39;)</span><br><span class="line"></span><br><span class="line">Text.render &#x3D; wrap(Text.render, function(func, ...args) &#123;</span><br><span class="line">  const originText &#x3D; func.apply(this, args)</span><br><span class="line">  return React.cloneElement(originText, &#123; allowFontScaling: false &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

基础包会将在入口配置的node_modules相关的引用与全局公共配置到basic.bundle.js

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: &#39;basic.js&#39;, &#x2F;&#x2F; 模块入口文件名称</span><br><span class="line">  isBase: true, &#x2F;&#x2F; 是否是基础模块</span><br><span class="line">  isAll: false,</span><br><span class="line">  metroConfig: &#39;metro_basic.config.js&#39;, &#x2F;&#x2F; 模块metro 配置文件，这个必须在项目根目录，rn 的 metro 只读取根目录文件</span><br><span class="line">  bundleName: &#123;</span><br><span class="line">    android: &#39;basic.android.bundle&#39;, &#x2F;&#x2F; 输出名称</span><br><span class="line">    ios: &#39;basic.bundle&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

2. 业务包

业务包配置

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: &#39;buz_act_618.js&#39;, &#x2F;&#x2F; 模块入口文件名称</span><br><span class="line">  isBase: false, &#x2F;&#x2F; 是否是基础模块</span><br><span class="line">  metroConfig: &#39;metro_buz.config.js&#39;,</span><br><span class="line">  bundleName: &#123;</span><br><span class="line">    android: &#39;act_618.android.bundle&#39;,</span><br><span class="line">    ios: &#39;act_618.bundle&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></code></pre><p>通过 npm run bundler 打包会在 bundles 路径生成相应 bundle.</p>
<ol start="4">
<li>上传包到平台<ol>
<li><code>npm run bundler:upload</code></li>
<li>CI/CD（待完善）</li>
</ol>
</li>
</ol>
<p><strong>大前端 RN 平台</strong><br><a href="http://fe-qa.qttcs3.cn/" target="_blank" rel="noopener">测试</a><br><a href="http://fe.qutoutiao.net/" target="_blank" rel="noopener">生产</a></p>
<hr>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">

    
    
    <a href="/2020/07/02/resume/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2020/05/28/跨平台开发指北/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2020-05-28 
	</div>
	

	<!-- categories -->
    

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2020 MIFind
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
