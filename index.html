<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>MIFind With Daria.</title>
  <meta name="author" content="MIFind">
  
  <meta name="description" content="永远相信美好的事情即将发生 —— Always believe that good things are about to happen.">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="MIFind With Daria."/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 4.2.1"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">MIFind With Daria.</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/us" title="About us.">
			  <i class=""></i>Us
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>
    The Inspiration And Daily.<span class="blink-fast">∎</span>
  </h1>
  <h3>永远相信美好的事情即将发生 —— Always believe that good things are about to happen.</h3>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">
   
  <i class="fa fa-heart blink-slow"></i>
   Missing u 393 
</div>

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/07/02/resume/" >个人简历</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-07-02  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>{: id=”20210222104133-b6l0tze”}</p>
<hr>
<h1 id="高级前端开发工程师"><a href="#高级前端开发工程师" class="headerlink" title="高级前端开发工程师"></a>高级前端开发工程师</h1><p>{: id=”20210222104133-o5jkyjl”}</p>
<ul>
<li>{: id=”20210222104133-31nd3if”}铉嘉伟/男/1993.2</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-psl4pq9”}本科/中北大学（2011 ~ 2015）</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-4qj0pc1”}工作年限：5 年</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-21p9l1u”}手机/微信：17666117715</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-l214vje”}Email：<a href="mailto:mifind@sina.com">mifind@sina.com</a></li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-hb2817e”}技术博客：<a href="http://milimili.online" target="_blank" rel="noopener">http://milimili.online</a><br>{: }<br>{: id=”20210222104133-hgh0idi”}</li>
</ul>
<hr>
<h2 id="求职意向"><a href="#求职意向" class="headerlink" title="求职意向"></a>求职意向</h2><p>{: id=”20210222104133-e0pk1av”}</p>
<ul>
<li>{: id=”20210222104133-w16qjm5”}期望职位：高级前端工程师</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-umtning”}期望城市：杭州</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-n40372w”}技术栈：Web（React、Vue）、Mobile（React Native）、Node<br>{: }<br>{: id=”20210222104133-64wuejr”}</li>
</ul>
<hr>
<h1 id="工作经历"><a href="#工作经历" class="headerlink" title="工作经历"></a>工作经历</h1><p>{: id=”20210222104133-0khtkmc”}</p>
<h2 id="趣头条-萌推（电商）（2019-年-9-月至今）"><a href="#趣头条-萌推（电商）（2019-年-9-月至今）" class="headerlink" title="趣头条-萌推（电商）（2019 年 9 月至今）"></a>趣头条-萌推（电商）（2019 年 9 月至今）</h2><p>{: id=”20210222104133-cwhxi0q”}</p>
<h3 id="1-萌推商家端-APP（React-Native）"><a href="#1-萌推商家端-APP（React-Native）" class="headerlink" title="1. 萌推商家端 APP（React Native）"></a>1. 萌推商家端 APP（React Native）</h3><p>{: id=”20210222104133-f3mxyxt”}</p>
<ul>
<li>{: id=”20210222104133-hh4ao4e”}作为萌推商家 APP 负责人，参与了萌推商家端 APP 的开发，该项目使用 React Native 进行开发，接手以后重构了 RN 版本，并 fork 0.61.5 分支出来 fix 一些版本 bug，达到一周内业务方 BUG 反馈率减少 50%，Crash 上报达到 0.01%以下。完成 RN 热更新平台搭建，热更新服务与原有拆包结合，完成原生改造，项目稳定运行中。<br>{: }<br>{: id=”20210222104133-9j8pjcg”}</li>
</ul>
<h3 id="2-萌掌柜（壳工具）开发工作"><a href="#2-萌掌柜（壳工具）开发工作" class="headerlink" title="2. 萌掌柜（壳工具）开发工作"></a>2. 萌掌柜（壳工具）开发工作</h3><p>{: id=”20210222104133-24dkcv1”}</p>
<ul>
<li>{: id=”20210222104133-spgat1w”}萌掌柜是萌推商家 PC 客服工具（类似千牛），主要负责 Electron 壳工具的开发，提供 web 与 PC Native 交互的通用 bridge 能力（截图、通知）。<br>项目为 PC Hybrid，壳、内容分离，为提供加载速度，完成 Electron 项目资源包 SDK。<br>{: }<br>{: id=”20210222104133-f4akfnp”}</li>
</ul>
<h3 id="3-萌推资源包研发（后台、SDK）"><a href="#3-萌推资源包研发（后台、SDK）" class="headerlink" title="3. 萌推资源包研发（后台、SDK）"></a>3. 萌推资源包研发（后台、SDK）</h3><p>{: id=”20210222104133-gaj8u71”}</p>
<ul>
<li>{: id=”20210222104133-lcgrqz2”}由于全量包 CDN 流量过大，为客户端完成资源包业务的改造，使用 Myer’s diff 与 bsdiff 算法完成资源包拆分与合并的 SDK，并部署了一套客户端资源包增量更新服务，可用于解决 Web 资源包、客户端 APK 资源拆分，大幅减少 CDN 流量。<br>{: }<br>{: id=”20210222104133-9jx0il1”}</li>
</ul>
<h3 id="4-QTT-RN-统一方案"><a href="#4-QTT-RN-统一方案" class="headerlink" title="4. QTT RN 统一方案"></a>4. QTT RN 统一方案</h3><p>{: id=”20210222104133-9dg5z5f”}</p>
<ul>
<li>{: id=”20210222104133-15wzwrh”}由于多项目想集成 RN 到原有原生项目做快速迭代开发，提供了一套 RN 统一方案，作为 RN 多 bundle 项目创建、拆包、分包热更新，开发者可以实时推送更新，然后客户端应用可以在应用启动时查询更新。借助 CodePush，不需要重新审核和安装应用，就可以解决应用的缺陷和添加新特性。同时平台提供了可视化操作，能进行发布，回滚，灰度发布，图表分析等。<br>{: }<br>{: id=”20210222104133-w2aityq”}</li>
</ul>
<h2 id="上海叶道科技有限公司（2018-年-9-月至-2019-年-9-月）"><a href="#上海叶道科技有限公司（2018-年-9-月至-2019-年-9-月）" class="headerlink" title="上海叶道科技有限公司（2018 年 9 月至 2019 年 9 月）"></a>上海叶道科技有限公司（2018 年 9 月至 2019 年 9 月）</h2><p>{: id=”20210222104133-lqir4u2”}</p>
<h3 id="独立站项目（类似-shopify，已关闭）。"><a href="#独立站项目（类似-shopify，已关闭）。" class="headerlink" title="独立站项目（类似 shopify，已关闭）。"></a>独立站项目（类似 shopify，已关闭）。</h3><p>{: id=”20210222104133-dei3qah”}</p>
<ul>
<li>{: id=”20210222104133-k3pyoab”}负责 C 端脚手架研发，主要技术栈是 node+art-template，通过模板引擎动态生成 env 配置，根据不同数据源选择 mixins 注入组件，动态编译组件，动态生成站点主题，对整个站点进行 health check，检测到配置区有信息改动，对项目进行动态编译。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-30k6uzz”}C 端页面组件细粒度拆分，将原有电商项目重构，页面整体细粒度组件化。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-hyojp35”}OMS 端，商品、组合商品上架、下架、物流更新、退换货操作等常规业务开发。<br>{: }<br>{: id=”20210222104133-arl214f”}</li>
</ul>
<h3 id="WhatsmodePay-支付组件"><a href="#WhatsmodePay-支付组件" class="headerlink" title="WhatsmodePay 支付组件"></a>WhatsmodePay 支付组件</h3><p>{: id=”20210222104133-1fujrnc”}</p>
<ul>
<li>{: id=”20210222104133-pjo2t7y”}PayPal、Asiabill、Stripe 等支付平台的聚合支付组件。该支付组件使用 react+redux+webpack 完成。<br>{: }<br>{: id=”20210222104133-ht0gu7l”}</li>
</ul>
<h3 id="Miraco-区块链电商平台"><a href="#Miraco-区块链电商平台" class="headerlink" title="Miraco 区块链电商平台"></a>Miraco 区块链电商平台</h3><p>{: id=”20210222104133-8l5e45b”}</p>
<ul>
<li>{: id=”20210222104133-81csaeb”}负责 Miraco 区块链电商平台的开发，Miraco 主要通过通过部署的 ETH 智能合约进行商品唯一性、物流追踪的区块链平台。</li>
</ul>
<p>{: }</p>
<ul>
<li><p>{: id=”20210222104133-oj5x59e”}负责 MIRACO WALLET 与米可百宝袋小程序。</p>
<ul>
<li>{: id=”20210222104133-742f2va”}APP 项目使用 ReactNative 开发（上线 Google Play 与非国内的所有 AppleStore）。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-uj8zwhe”}后端接口与钱包服务(加密、账户生成、通信签名)使用 Node（Web3Util）开发，nginx 配置钱包微服务与智能合约、后端交互。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-aiq938m”}完成了微信小程序版本(米可百宝袋) -（mpvue）。<br>{: }<br>{: id=”20210222104133-3gmrz71”}<br>{: }<br>{: id=”20210222104133-72etcf4”}</li>
</ul>
</li>
</ul>
<h2 id="美的集团-（-2017-年-4-月-2018-年-4-月-）"><a href="#美的集团-（-2017-年-4-月-2018-年-4-月-）" class="headerlink" title="美的集团 （ 2017 年 4 月 ~ 2018 年 4 月 ）"></a>美的集团 （ 2017 年 4 月 ~ 2018 年 4 月 ）</h2><p>{: id=”20210222104133-9zaz2qh”}</p>
<h3 id="GIS-基础平台-PCWeb-Vue-ArcGIS-Java"><a href="#GIS-基础平台-PCWeb-Vue-ArcGIS-Java" class="headerlink" title="GIS 基础平台-PCWeb(Vue/ArcGIS/Java)"></a>GIS 基础平台-PCWeb(Vue/ArcGIS/Java)</h3><p>{: id=”20210222104133-29b9av5”}</p>
<ul>
<li>{: id=”20210222104133-gr7rigw”}负责 GIS 基础平台后台页面的开发（element-ui + vue），负责地图页面与组件展示与调试。<br>{: }<br>{: id=”20210222104133-cdloimp”}</li>
</ul>
<h3 id="盈峰项目管家-App-Android-ReactNative"><a href="#盈峰项目管家-App-Android-ReactNative" class="headerlink" title="盈峰项目管家 App(Android/ReactNative)"></a>盈峰项目管家 App(Android/ReactNative)</h3><p>{: id=”20210222104133-61s0pjv”}</p>
<ul>
<li>{: id=”20210222104133-5ur9vmd”}负责盈峰项目管家 Android 版本与 ReactNative 版本开发。<br>{: }<br>{: id=”20210222104133-c4w9cxq”}</li>
</ul>
<h2 id="平安科技（2015-年-7-月-2017-年-4-月）"><a href="#平安科技（2015-年-7-月-2017-年-4-月）" class="headerlink" title="平安科技（2015 年 7 月 ~ 2017 年 4 月）"></a>平安科技（2015 年 7 月 ~ 2017 年 4 月）</h2><p>{: id=”20210222104133-jpis1z0”}</p>
<h3 id="口袋银行-信用卡模块（Vue）"><a href="#口袋银行-信用卡模块（Vue）" class="headerlink" title="口袋银行-信用卡模块（Vue）"></a>口袋银行-信用卡模块（Vue）</h3><p>{: id=”20210222104133-5gn5v26”}</p>
<ul>
<li>{: id=”20210222104133-ssxextd”}对接口袋银行完成信用卡部分活动页开发工作。<br>{: }<br>{: id=”20210222104133-wfnh8o0”}</li>
</ul>
<h3 id="平安信用卡（ReactNative）"><a href="#平安信用卡（ReactNative）" class="headerlink" title="平安信用卡（ReactNative）"></a>平安信用卡（ReactNative）</h3><p>{: id=”20210222104133-7isd525”}</p>
<ul>
<li>{: id=”20210222104133-honazaj”}负责平安信用卡 ReactNative 版本部分模块的开发工作。<br>{: }<br>{: id=”20210222104133-epqxe41”}</li>
</ul>
<h3 id="平安信用卡（Android）"><a href="#平安信用卡（Android）" class="headerlink" title="平安信用卡（Android）"></a>平安信用卡（Android）</h3><p>{: id=”20210222104133-sg4nvti”}</p>
<ul>
<li>{: id=”20210222104133-44cud5o”}负责卡片激活、密码管理、188 红包、云闪付（NFC）、用户登录、设置、小额免密等 Native 页面的开发。<br>{: }<br>{: id=”20210222104133-9c8ezy6”}</li>
</ul>
<hr>
<h1 id="技能清单"><a href="#技能清单" class="headerlink" title="技能清单"></a>技能清单</h1><p>{: id=”20210222104133-eu2u6yw”}</p>
<ul>
<li>{: id=”20210222104133-1hx0qd7”}前端框架：JS 及各种框架们</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-wy78g0e”}跨平台技术框架：ReactNative/Flutter/Taro/mpvue</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-2ejq0a9”}移动端：Android/Kotlin</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-sgfigea”}后端：Node/Java</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-hikyk4w”}数据库相关：SQL/MongoDB</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-xuql76x”}基础运维：nginx、docker</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-c1f2a4b”}版本管理：Git</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-uara394”}主要语言 JS、TS<br>{: }<br>{: id=”20210222104133-mfuul5e”}</li>
</ul>
<h1 id="技能证书"><a href="#技能证书" class="headerlink" title="技能证书:"></a>技能证书:</h1><p>{: id=”20210222104133-8r6laq5”}</p>
<p><a href="https://www.freecodecamp.org/mifind/front-end-certification" target="_blank" rel="noopener">Front End Development of FreeCodeCamp</a><br>{: id=”20210222104133-8crvmf6”}</p>
<p>蓝桥杯 Java 组省一<br>{: id=”20210222104133-yb7ju4x”}</p>
<hr>
<h1 id="致谢"><a href="#致谢" class="headerlink" title="致谢"></a>致谢</h1><p>{: id=”20210222104133-j3ymvlo”}</p>
<p>愿意承担前端、移动端、全栈工程师的工作，渴望加入一个优秀的团队并愿意与其共同成长。感谢您花时间阅读我的简历，期待能有机会和您共事。<br>{: id=”20210222104133-og2lnx0”}</p>
<p>{: id=”20210222104133-wr0p0e4” type=”doc”}</p>

	
	</div>
  <a type="button" href="/2020/07/02/resume/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/06/15/ReactNativeInNative/" >ReactNative集成到现有原生项目、拆包、热更新</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-06-15  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>{: id=”20210222104133-95ci8wv” updated=”20210222104235”}</p>
<h1 id="ReactNative-集成到现有原生项目、拆包、热更新"><a href="#ReactNative-集成到现有原生项目、拆包、热更新" class="headerlink" title="ReactNative 集成到现有原生项目、拆包、热更新"></a>ReactNative 集成到现有原生项目、拆包、热更新</h1><p>{: id=”20210222104133-5dhqyas”}</p>
<hr>
<p>如果你正准备从头开始制作一个新的应用，那么 React Native 会是个非常好的选择。但是大多数项目我们已经有一个原生应用，React Native 作为业务 module，集成到原生应用中。我们一个应用中可能有很多 RN 业务模块，那 module 拆包、热更新就尤为重要。<br>{: id=”20210222104133-tna10z5”}</p>
<h2 id="集成到现有原生项目"><a href="#集成到现有原生项目" class="headerlink" title="集成到现有原生项目"></a>集成到现有原生项目</h2><p>{: id=”20210222104133-vmyz2td”}</p>
<h3 id="集成到原生项目，首先要安装-RN-开发环境。"><a href="#集成到原生项目，首先要安装-RN-开发环境。" class="headerlink" title="集成到原生项目，首先要安装 RN 开发环境。"></a>集成到原生项目，首先要安装 RN 开发环境。</h3><p>{: id=”20210222104133-yo0dm16”}</p>
<ol>
<li>{: id=”20210222104133-p7karmt”}<a href="https://reactnative.cn/docs/getting-started.html" target="_blank" rel="noopener">搭建 RN 开发环境</a><br>{: id=”20210222104203-jakagf3”}<br>{: id=”20210222104203-wkdwnv5”}</li>
</ol>
<p>{: }<br>2. {: id=”20210222104133-iqkjay0”}由于是集成到现有原生项目，不需要 init 一个新的 RN 项目。<br>{: id=”20210222104203-4e1o1bs”}</p>
<ol>
<li>{: id=”20210222104133-iibyj3l”}获取 RN 项目库，并执行<code>npm install</code>，安装 RN 项目所需要依赖。<br>{: id=”20210222104203-dr1j8r5”}<br>{: id=”20210222104203-fgd1cuv”}</li>
</ol>
<p>{: }<br>2. {: id=”20210222104133-8o1menq”}如果没有 RN 项目库，需要同步当前需要集成的 RN 项目的 package.json，并执行<code>npm install</code><br>{: }<br>{: id=”20210222104133-iws0yq6”}</p>
<p>{: }<br>{: id=”20210222104133-42fpp97”}</p>
<h3 id="1-Android"><a href="#1-Android" class="headerlink" title="1 Android"></a>1 Android</h3><p>{: id=”20210222104133-98bpu4y”}</p>
<h4 id="1-project-gradle-添加配置"><a href="#1-project-gradle-添加配置" class="headerlink" title="1. project gradle 添加配置"></a>1. project gradle 添加配置</h4><p>{: id=”20210222104133-ggvmp2x”}</p>
<p>在项目的 build.gradle 文件中为 React Native 添加一个 maven 依赖的入口，必须写在 “allprojects” 代码块中。<br>{: id=”20210222104133-5t1pg7t”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">         &#x2F;&#x2F;rn</span><br><span class="line">        maven &#123;</span><br><span class="line">            url &quot;$rootDir&#x2F;..&#x2F;node_modules&#x2F;react-native&#x2F;android&quot;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        maven &#123;</span><br><span class="line">            url(&quot;$rootDir&#x2F;..&#x2F;node_modules&#x2F;jsc-android&#x2F;dist&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;qtt maven-&gt; codepush</span><br><span class="line">         maven &#123;</span><br><span class="line">            url &quot;http:&#x2F;&#x2F;nexus.qutoutiao.net&#x2F;repository&#x2F;android&#x2F;&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;rn end</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-x62nhli”}</p>
<h4 id="2-app-gradle-添加配置"><a href="#2-app-gradle-添加配置" class="headerlink" title="2. app gradle 添加配置"></a>2. app gradle 添加配置</h4><p>{: id=”20210222104133-j2bkjjd”}</p>
<p>在 app 中 build.gradle 文件中添加 React Native 依赖:<br>{: id=”20210222104133-uem0iq2”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;rn</span><br><span class="line">project.ext.react &#x3D; [</span><br><span class="line">        entryFile: &quot;index.js&quot;,</span><br><span class="line">        enableHermes: false,  &#x2F;&#x2F; clean and rebuild if changing</span><br><span class="line">        jsBundleDirRelease: &quot;$buildDir&#x2F;intermediates&#x2F;merged_assets&#x2F;release&#x2F;out&#x2F;index&quot;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">apply from: &quot;..&#x2F;..&#x2F;node_modules&#x2F;react-native&#x2F;react.gradle&quot;</span><br><span class="line"></span><br><span class="line">def enableHermes &#x3D; project.ext.react.get(&quot;enableHermes&quot;, false);</span><br><span class="line"></span><br><span class="line">def jscFlavor &#x3D; &#39;org.webkit:android-jsc:+&#39;</span><br><span class="line"></span><br><span class="line">def safeExtGet(prop, fallback) &#123;</span><br><span class="line">    rootProject.ext.has(prop) ? rootProject.ext.get(prop) : fallback</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;rn end</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-d31kz4x”}</p>
<p>添加 gradle 依赖<br>{: id=”20210222104133-hp7hkw9”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;rn</span><br><span class="line">    if (enableHermes) &#123;</span><br><span class="line">        def hermesPath &#x3D; &quot;..&#x2F;..&#x2F;node_modules&#x2F;hermesvm&#x2F;android&#x2F;&quot;;</span><br><span class="line">        debugImplementation files(hermesPath + &quot;hermes-debug.aar&quot;)</span><br><span class="line">        releaseImplementation files(hermesPath + &quot;hermes-release.aar&quot;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        implementation jscFlavor</span><br><span class="line">    &#125;</span><br><span class="line">    implementation &quot;com.facebook.react:react-native:+&quot; &#x2F;&#x2F; From node_modules</span><br><span class="line">    implementation &quot;androidx.swiperefreshlayout:swiperefreshlayout:1.0.0&quot;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 这里使用手动引入依赖，所以要手动添加。如果auto-link这里不用引用。</span><br><span class="line">    implementation project(&#39;:@react-native-community_masked-view&#39;)</span><br><span class="line">    implementation project(&#39;:react-native-gesture-handler&#39;)</span><br><span class="line">    implementation project(&#39;:react-native-reanimated&#39;)</span><br><span class="line">    implementation project(&#39;:react-native-safe-area-context&#39;)</span><br><span class="line">    implementation project(&#39;:react-native-screens&#39;)</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; --&gt; codepush</span><br><span class="line">    implementation project(&#39;:@innotechx_react-native-code-push&#39;)</span><br><span class="line">    &#x2F;&#x2F;rn end</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-sku4l1i”}</p>
<p>最下面添加 codepush 引用。<br>{: id=”20210222104133-2v38uns”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply from: file(&quot;..&#x2F;..&#x2F;node_modules&#x2F;@innotechx&#x2F;react-native-code-push&#x2F;android&#x2F;codepush.gradle&quot;)</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-plyfxdr”}</p>
<p>注意确认 node_modules 所在的目录位置。<br>{: id=”20210222104133-fj315my”}</p>
<h4 id="3-settings-gradle-添加配置"><a href="#3-settings-gradle-添加配置" class="headerlink" title="3. settings.gradle 添加配置"></a>3. settings.gradle 添加配置</h4><p>{: id=”20210222104133-i7gwjtb”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">include &#39;:@innotechx_react-native-code-push&#39;</span><br><span class="line">project(&#39;:@innotechx_react-native-code-push&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;@innotechx&#x2F;react-native-code-push&#x2F;android&#x2F;app&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:react-native-gesture-handler&#39;</span><br><span class="line">project(&#39;:react-native-gesture-handler&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;react-native-gesture-handler&#x2F;android&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:react-native-reanimated&#39;</span><br><span class="line">project(&#39;:react-native-reanimated&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;react-native-reanimated&#x2F;android&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:react-native-safe-area-context&#39;</span><br><span class="line">project(&#39;:react-native-safe-area-context&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;react-native-safe-area-context&#x2F;android&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:react-native-screens&#39;</span><br><span class="line">project(&#39;:react-native-screens&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;react-native-screens&#x2F;android&#39;)</span><br><span class="line"></span><br><span class="line">include &#39;:@react-native-community_masked-view&#39;</span><br><span class="line">project(&#39;:@react-native-community_masked-view&#39;).projectDir &#x3D; new File(rootProject.projectDir, &#39;..&#x2F;node_modules&#x2F;@react-native-community&#x2F;masked-view&#x2F;android&#39;)</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-sxy5kn2”}</p>
<h4 id="4-AndroidManifest-xml"><a href="#4-AndroidManifest-xml" class="headerlink" title="4. AndroidManifest.xml"></a>4. AndroidManifest.xml</h4><p>{: id=”20210222104133-tahc1ys”}</p>
<p>1 声明网络权限<br><br><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;</code><br>{: id=”20210222104133-u5thw64”}</p>
<p>2 添加开发者菜单<br><br><code>&lt;activity android:name=&quot;com.facebook.react.devsupport.DevSettingsActivity&quot; /&gt;</code><br>{: id=”20210222104133-x27vpy8”}</p>
<p>3 network_security_config.xml(API level 28+)<br><br>{: id=”20210222104133-1g7me5j”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">  android:networkSecurityConfig&#x3D;&quot;@xml&#x2F;network_security_config&quot;&gt;</span><br><span class="line">&lt;&#x2F;application&gt;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-0q26ppz”}</p>
<p>在<code>/res/xml</code>中添加<code>network_security_config.xml</code><br>{: id=”20210222104133-xods5g0”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;network-security-config&gt;</span><br><span class="line">    &lt;base-config cleartextTrafficPermitted&#x3D;&quot;true&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;network-security-config&gt;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-mglq59g”}</p>
<h4 id="4-将兜底包放到-assets-目录下"><a href="#4-将兜底包放到-assets-目录下" class="headerlink" title="4. 将兜底包放到 assets 目录下"></a>4. 将兜底包放到 assets 目录下</h4><p>{: id=”20210222104133-k8nvccz”}</p>
<h4 id="5-根据-demo-改造原生代码"><a href="#5-根据-demo-改造原生代码" class="headerlink" title="5. 根据 demo 改造原生代码"></a>5. 根据 demo 改造原生代码</h4><p>{: id=”20210222104133-n66hha4”}</p>
<p>主要为加载 bundle、拆包、热更新的相关实现。<br>{: id=”20210222104133-t42jtyq”}</p>
<ul>
<li>{: id=”20210222104133-jup9wae”}JsLoaderUtil<br>{: id=”20210222104203-udmaaib”}<br>{: id=”20210222104203-rfh8oci”}</li>
</ul>
<p>{: }<br>{: id=”20210222104203-wk7x386”}</p>
<ul>
<li>{: id=”20210222104133-0e2hwyz”}BaseReactActivity<br>{: id=”20210222104203-y2v1ksi”}<br>{: id=”20210222104203-st9w2or”}</li>
</ul>
<p>{: }<br>{: id=”20210222104203-ujle8kr”}</p>
<ul>
<li>{: id=”20210222104133-7o01vuo”}SpConfig<br>{: }<br>{: id=”20210222104203-jqbgcb6”}<br>{: id=”20210222104133-3qotvlp”}</li>
</ul>
<p>对 Application 的改造: 继承 ReactApplication。<br>{: id=”20210222104133-cf9rucx”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class MainApplication extends Application implements ReactApplication &#123;</span><br><span class="line"></span><br><span class="line">    public static Application app;</span><br><span class="line"></span><br><span class="line">    private SpConfig sc;</span><br><span class="line"></span><br><span class="line">    private final ReactNativeHost mReactNativeHost &#x3D; new ReactNativeHost(this) &#123;</span><br><span class="line"></span><br><span class="line">        private String moduleId &#x3D; &quot;basic&quot;;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public boolean getUseDeveloperSupport() &#123;</span><br><span class="line">            JsLoaderUtil.jsState.isDev &#x3D; sc.getLoadRuntime();</span><br><span class="line">            return sc.getLoadRuntime();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        protected List&lt;ReactPackage&gt; getPackages() &#123;</span><br><span class="line">        	&#x2F;&#x2F; 这里要添加进去RNPackage</span><br><span class="line">            return new ArrayList&lt;&gt;(Arrays.&lt;ReactPackage&gt;asList(</span><br><span class="line">                    new MainReactPackage(),</span><br><span class="line">                    new RNCMaskedViewPackage(),</span><br><span class="line">                    new RNGestureHandlerPackage(),</span><br><span class="line">                    new ReanimatedPackage(),</span><br><span class="line">                    new SafeAreaContextPackage(),</span><br><span class="line">                    new RNScreensPackage(),</span><br><span class="line">                    new CodePush(&quot;Xzy1V0cWXWDuh7Bb7HogAraIAJLT4c266bc0c0&quot;, MainApplication.this, this.moduleId, BuildConfig.DEBUG, &quot;http:&#x2F;&#x2F;code-push-server.qutoutiao.net&#x2F;&quot;)</span><br><span class="line">            ));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Nullable</span><br><span class="line">        @Override</span><br><span class="line">        protected String getJSBundleFile() &#123;</span><br><span class="line">            return CodePush.getJSBundleFile(this.moduleId, &quot;basic.android.bundle&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Nullable</span><br><span class="line">        @Override</span><br><span class="line">        protected String getBundleAssetName() &#123;</span><br><span class="line">            return &quot;basic&#x2F;basic.android.bundle&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        protected String getJSMainModuleName() &#123;</span><br><span class="line">            return &quot;index&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ReactNativeHost getReactNativeHost() &#123;</span><br><span class="line">        return mReactNativeHost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        super.onCreate();</span><br><span class="line">        sc &#x3D; new SpConfig(this);</span><br><span class="line">        app &#x3D; this;</span><br><span class="line">        SoLoader.init(this, &#x2F;* native exopackage *&#x2F; false);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-nhms8t1”}</p>
<p>当前实现是基于基类<code>BaseReactActivity</code>，这样加载 RN module 的业务组件只需要继承<code>BaseReactActivity</code>即可。<br>{: id=”20210222104133-ltft310”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Business1Activity extends BaseReactActivity &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected String getBundleName() &#123;</span><br><span class="line">        return &quot;act_618.android.bundle&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    @Override</span><br><span class="line">    protected String getMainComponentName() &#123;</span><br><span class="line">        return &quot;act_618&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected String getModuleId() &#123;</span><br><span class="line">        return &quot;buz_act_618&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-y9zd6ug”}</p>
<p><strong>注意</strong>： 如果 Android 项目的根目录名就是 android，才可以使用自动引用，就不需要 settings.gradle 与 app build.gradle 里做手动引用依赖，相应的 MainApplication 的 add package 也需要修改。<br>{: id=”20210222104133-4pvw6gd”}</p>
<p><strong>CodePush 相关</strong>：<a href="https://developer.qutoutiao.net/wiki/#/8/README?id=android" target="_blank" rel="noopener">相关配置参考</a><br>{: id=”20210222104133-svxucro”}</p>
<h3 id="2-IOS"><a href="#2-IOS" class="headerlink" title="2 IOS"></a>2 IOS</h3><p>{: id=”20210222104133-iqxt7a5”}</p>
<h4 id="1-Podfile-修改"><a href="#1-Podfile-修改" class="headerlink" title="1. Podfile 修改"></a>1. Podfile 修改</h4><p>{: id=”20210222104133-2vzkqpb”}</p>
<p>将以下 Podfile 内容配置到你的 Podfile 文件里，<code>pod install</code><br>{: id=”20210222104133-hsarpyt”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">platform :ios, &#39;9.0&#39;</span><br><span class="line">require_relative &#39;..&#x2F;node_modules&#x2F;@react-native-community&#x2F;cli-platform-ios&#x2F;native_modules&#39;</span><br><span class="line"></span><br><span class="line"># target的名字一般与你的项目名字相同</span><br><span class="line">target &#39;reactnative_multibundler&#39; do</span><br><span class="line"></span><br><span class="line">  # &#39;node_modules&#39;目录一般位于根目录中</span><br><span class="line">  # 但是如果你的结构不同，那你就要根据实际路径修改下面的&#96;:path&#96;</span><br><span class="line">  pod &#39;FBLazyVector&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;FBLazyVector&quot;</span><br><span class="line">  pod &#39;FBReactNativeSpec&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;FBReactNativeSpec&quot;</span><br><span class="line">  pod &#39;RCTRequired&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;RCTRequired&quot;</span><br><span class="line">  pod &#39;RCTTypeSafety&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;TypeSafety&quot;</span><br><span class="line">  pod &#39;React&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;&#39;</span><br><span class="line">  pod &#39;React-Core&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;&#39;</span><br><span class="line">  pod &#39;React-CoreModules&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;React&#x2F;CoreModules&#39;</span><br><span class="line">  pod &#39;React-Core&#x2F;DevSupport&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;&#39;</span><br><span class="line">  pod &#39;React-RCTActionSheet&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;ActionSheetIOS&#39;</span><br><span class="line">  pod &#39;React-RCTAnimation&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;NativeAnimation&#39;</span><br><span class="line">  pod &#39;React-RCTBlob&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Blob&#39;</span><br><span class="line">  pod &#39;React-RCTImage&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Image&#39;</span><br><span class="line">  pod &#39;React-RCTLinking&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;LinkingIOS&#39;</span><br><span class="line">  pod &#39;React-RCTNetwork&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Network&#39;</span><br><span class="line">  pod &#39;React-RCTSettings&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Settings&#39;</span><br><span class="line">  pod &#39;React-RCTText&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Text&#39;</span><br><span class="line">  pod &#39;React-RCTVibration&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;Libraries&#x2F;Vibration&#39;</span><br><span class="line">  pod &#39;React-Core&#x2F;RCTWebSocket&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;&#39;</span><br><span class="line"></span><br><span class="line">  pod &#39;React-cxxreact&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;cxxreact&#39;</span><br><span class="line">  pod &#39;React-jsi&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;jsi&#39;</span><br><span class="line">  pod &#39;React-jsiexecutor&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;jsiexecutor&#39;</span><br><span class="line">  pod &#39;React-jsinspector&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;jsinspector&#39;</span><br><span class="line">  pod &#39;ReactCommon&#x2F;jscallinvoker&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&quot;</span><br><span class="line">  pod &#39;ReactCommon&#x2F;turbomodule&#x2F;core&#39;, :path &#x3D;&gt; &quot;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&quot;</span><br><span class="line">  pod &#39;Yoga&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;ReactCommon&#x2F;yoga&#39;</span><br><span class="line"></span><br><span class="line">  pod &#39;DoubleConversion&#39;, :podspec &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;third-party-podspecs&#x2F;DoubleConversion.podspec&#39;</span><br><span class="line">  pod &#39;glog&#39;, :podspec &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;third-party-podspecs&#x2F;glog.podspec&#39;</span><br><span class="line">  pod &#39;Folly&#39;, :podspec &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;react-native&#x2F;third-party-podspecs&#x2F;Folly.podspec&#39;</span><br><span class="line"></span><br><span class="line">  pod &#39;CodePush&#39;, :path &#x3D;&gt; &#39;..&#x2F;node_modules&#x2F;@innotechx&#x2F;react-native-code-push&#39;</span><br><span class="line"></span><br><span class="line">  pod &#39;SSZipArchive&#39;</span><br><span class="line"></span><br><span class="line">  use_native_modules!</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-yhnc9s2”}</p>
<h4 id="2-将兜底包放到项目里"><a href="#2-将兜底包放到项目里" class="headerlink" title="2. 将兜底包放到项目里"></a>2. 将兜底包放到项目里</h4><p>{: id=”20210222104133-u54p903”}</p>
<h4 id="3-根据-demo-改造原生代码"><a href="#3-根据-demo-改造原生代码" class="headerlink" title="3. 根据 demo 改造原生代码"></a>3. 根据 demo 改造原生代码</h4><p>{: id=”20210222104133-vq4dmzl”}</p>
<p>主要为加载 bundle、拆包、热更新的相关实现。<br>{: id=”20210222104133-ov8g2wr”}</p>
<ul>
<li>{: id=”20210222104133-i91dhh1”}ScriptLoadUtil<br>{: id=”20210222104203-tz7eptz”}<br>{: id=”20210222104203-ovtzqjp”}</li>
</ul>
<p>{: }<br>{: id=”20210222104203-vkn4v7k”}</p>
<ul>
<li>{: id=”20210222104133-2q3fzaz”}ReactController<br>{: id=”20210222104203-85jw8mt”}<br>{: id=”20210222104203-njw1d2w”}</li>
</ul>
<p>{: }<br>{: id=”20210222104203-jnw8ty0”}</p>
<ul>
<li>{: id=”20210222104133-ck0g9pg”}RctBridge<br>{: }<br>{: id=”20210222104203-ltuslti”}<br>{: id=”20210222104133-nz160uc”}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">1、暴露RCTBridge的executeSourceCode方法，做法为将本项目中的RCTBridge添加到自己的工程</span><br><span class="line"></span><br><span class="line">2、事先加载基础包：</span><br><span class="line"></span><br><span class="line">jsCodeLocation &#x3D; [[NSBundle mainBundle] URLForResource:@&quot;platform.ios&quot; withExtension:@&quot;bundle&quot;];</span><br><span class="line">bridge &#x3D; [[RCTBridge alloc] initWithBundleURL:jsCodeLocation</span><br><span class="line">                             moduleProvider:nil</span><br><span class="line">                              launchOptions:launchOptions];</span><br><span class="line"></span><br><span class="line">3、加载业务包：</span><br><span class="line"></span><br><span class="line">NSURL *jsCodeLocationBuz &#x3D; [[NSBundle mainBundle] URLForResource:bundleName withExtension:@&quot;bundle&quot;];</span><br><span class="line">  NSError *error &#x3D; nil;</span><br><span class="line">  NSData *sourceBuz &#x3D; [NSData dataWithContentsOfFile:jsCodeLocationBuz.path</span><br><span class="line">                                         options:NSDataReadingMappedIfSafe</span><br><span class="line">                                           error:&amp;error];</span><br><span class="line">  [bridge.batchedBridge executeSourceCode:sourceBuz sync:NO];</span><br><span class="line"></span><br><span class="line">4、创建RCTRootView，并绑定业务代码</span><br><span class="line"></span><br><span class="line">RCTRootView* view &#x3D; [[RCTRootView alloc] initWithBridge:bridge moduleName:moduleName initialProperties:nil];</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-l8w5vn6”}</p>
<p><strong>CodePush 相关</strong>：<a href="https://developer.qutoutiao.net/wiki/#/8/README?id=ios" target="_blank" rel="noopener">相关配置参考</a><br>{: id=”20210222104133-eprxfqq”}</p>
<hr>
<h2 id="ReactNative-拆包与多业务开发"><a href="#ReactNative-拆包与多业务开发" class="headerlink" title="ReactNative 拆包与多业务开发"></a>ReactNative 拆包与多业务开发</h2><p>{: id=”20210222104133-9a6ejxf”}</p>
<ol>
<li>{: id=”20210222104133-mquck4d”}创建业务<br><br><code>npm run create</code>会在<code>/src/modules</code>里创建业务模块。<br>{: id=”20210222104133-vn55oy5”}<br>{: id=”20210222104203-vuzobzy”}</li>
</ol>
<p>{: }<br>{: id=”20210222104203-4gs1g6d”}</p>
<ol start="2">
<li>{: id=”20210222104133-au74lmr”}开发与 debug<br><br><code>npm run start</code>开启 metro packager，然后在集成好的 Native 项目查看效果（或者打开 RNHybrid Demo 查看效果）<br>{: id=”20210222104133-o7u7f7g”}<br>{: id=”20210222104203-mmfux6x”}</li>
</ol>
<p>{: }<br>{: id=”20210222104203-ofwf4iq”}</p>
<ol start="3">
<li><p>{: id=”20210222104133-knwufka”}打包<br><br>通过<code>npm run bundler</code>打包基础包与业务包。 1. 基础包配置<br><br>{: id=”20210222104133-3cxwpbt”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">基础包入口 - basic.js</span><br><span class="line">import React from &#39;react&#39;</span><br><span class="line">import &#123; Text &#125; from &#39;react-native&#39;</span><br><span class="line">import &#39;react-native&#39;</span><br><span class="line">import &#39;mobx&#39;</span><br><span class="line">import &#39;mobx-react&#39;</span><br><span class="line">import &#39;mobx-react-lite&#39;</span><br><span class="line">import &#39;react-native-gesture-handler&#39;</span><br><span class="line">import &#39;react-native-safe-area-context&#39;</span><br><span class="line">import &#39;react-native-reanimated&#39;</span><br><span class="line">import &#39;react-native-screens&#39;</span><br><span class="line"></span><br><span class="line">import &#39;@innotechx&#x2F;react-native-code-push&#39;</span><br><span class="line"></span><br><span class="line">import &#39;@react-native-community&#x2F;masked-view&#39;</span><br><span class="line">import &#39;@react-navigation&#x2F;stack&#39;</span><br><span class="line">import &#39;@react-navigation&#x2F;native&#39;</span><br><span class="line"></span><br><span class="line">const wrap &#x3D; require(&#39;lodash.wrap&#39;)</span><br><span class="line"></span><br><span class="line">Text.render &#x3D; wrap(Text.render, function(func, ...args) &#123;</span><br><span class="line">  const originText &#x3D; func.apply(this, args)</span><br><span class="line">  return React.cloneElement(originText, &#123; allowFontScaling: false &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-6oykgp1”}</p>
<p>基础包会将在入口配置的node_modules相关的引用与全局公共配置到basic.bundle.js<br>{: id=”20210222104133-0efm03n”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: &#39;basic.js&#39;, &#x2F;&#x2F; 模块入口文件名称</span><br><span class="line">  isBase: true, &#x2F;&#x2F; 是否是基础模块</span><br><span class="line">  isAll: false,</span><br><span class="line">  metroConfig: &#39;metro_basic.config.js&#39;, &#x2F;&#x2F; 模块metro 配置文件，这个必须在项目根目录，rn 的 metro 只读取根目录文件</span><br><span class="line">  bundleName: &#123;</span><br><span class="line">    android: &#39;basic.android.bundle&#39;, &#x2F;&#x2F; 输出名称</span><br><span class="line">    ios: &#39;basic.bundle&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-pv1sukq”}</p>
<ol start="2">
<li>{: id=”20210222104133-m0owcqr”}业务包<br>{: }<br>{: id=”20210222104203-gjpf1oi”}<br>{: id=”20210222104133-jxr03y8”}</li>
</ol>
<p>业务包配置<br>{: id=”20210222104133-o4w1c0r”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  name: &#39;buz_act_618.js&#39;, &#x2F;&#x2F; 模块入口文件名称</span><br><span class="line">  isBase: false, &#x2F;&#x2F; 是否是基础模块</span><br><span class="line">  metroConfig: &#39;metro_buz.config.js&#39;,</span><br><span class="line">  bundleName: &#123;</span><br><span class="line">    android: &#39;act_618.android.bundle&#39;,</span><br><span class="line">    ios: &#39;act_618.bundle&#39;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-0utqp0l”}<br>{: id=”20210222104203-11ijhh4”}</p>
</li>
</ol>
<p>{: }<br>{: id=”20210222104133-p6kjw79”}</p>
<p>通过 npm run bundler 打包会在 bundles 路径生成相应 bundle.<br>{: id=”20210222104133-udpckdn”}</p>
<ol start="4">
<li><p>{: id=”20210222104133-s75fbjn”}上传包到平台<br>{: id=”20210222104203-lq067m9”}</p>
<ol>
<li>{: id=”20210222104133-9ottgez”}<code>npm run bundler:upload</code><br>{: id=”20210222104203-ce2ftfv”}<br>{: id=”20210222104203-63cafzu”}</li>
</ol>
<p>{: }</p>
<ol start="2">
<li>{: id=”20210222104133-ij6y5qs”}CI/CD（待完善）<br>{: }<br>{: id=”20210222104133-rxe5f64”}<br>{: id=”20210222104203-sjpy3be”}</li>
</ol>
</li>
</ol>
<p>{: }<br>{: id=”20210222104133-4ulh8f7”}</p>
<p><strong>大前端 RN 平台</strong><br><a href="http://fe-qa.qttcs3.cn/" target="_blank" rel="noopener">测试</a><br><a href="http://fe.qutoutiao.net/" target="_blank" rel="noopener">生产</a><br>{: id=”20210222104133-pe7sehg”}</p>
<hr>
<p>{: id=”20210222104133-sgy6ef8” type=”doc”}</p>

	
	</div>
  <a type="button" href="/2020/06/15/ReactNativeInNative/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2020/05/28/跨平台开发指北/" >跨平台开发指北</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2020-05-28  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>{: id=”20210222104133-dsqrc4s”}</p>
<h1 id="跨平台APP开发实践（RN、Flutter）"><a href="#跨平台APP开发实践（RN、Flutter）" class="headerlink" title="跨平台APP开发实践（RN、Flutter）"></a>跨平台APP开发实践（RN、Flutter）</h1><p>{: id=”20210222104133-sj8322m”}</p>
<hr>
<h2 id="0-前言"><a href="#0-前言" class="headerlink" title="0. 前言"></a>0. 前言</h2><p>{: id=”20210222104133-9qjgla5”}</p>
<p><code>跨平台的优势</code>：<br>{: id=”20210222104133-c6smea3”}</p>
<blockquote>
<ul>
<li>{: id=”20210222104133-svn3ptt”}<code>真正的原生应用</code>：产生的不是网页应用，不是混合应用，而是一个原生的移动应用。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-oy6lit2”}<code>快速开发应用</code>：相比原生漫长的编译过程，Hot Reload简直不要太爽。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-mv3a3w5”}<code>可随时呼叫原生外援</code>：完美兼容Java/Swift/OC的组件，一部分用原生一部分用RN来做完全可以。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-7rg3n5v”}<code>跨平台</code>：一套业务逻辑代码可以稳定运行在两个平台。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-p53l8lw”}<code>节省劳动力</code>：为企业节省劳动力。。。（不知道算不算好事儿）。<br>{: }<br>{: id=”20210222104133-22zodjy”}<br>{: id=”20210222104133-rz75gp8”}</li>
</ul>
</blockquote>
<ul>
<li>{: id=”20210222104133-wpyz13j”}##### 使用Flutter的应用：闲鱼、美团B端、阿里（FlutterGo、AliFlutter、淘宝特价版）、字节（今日头条、西瓜视频、皮皮虾）<br>{: id=”20210222104133-nqxf8u6”}</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-gppnsr4”}##### 使用React Native的应用：携程、美团C端、字节（今日头条）、手机QQ、FaceBook<br>{: id=”20210222104133-txcjysy”}<br>{: }<br>{: id=”20210222104133-jf18684”}</li>
</ul>
<p>可以看出RN和Flutter还是呈五五开的发展态势。<br>github：<br>{: id=”20210222104133-sjyvbae”}</p>
<ul>
<li>{: id=”20210222104133-8msrpiu”}<a href="https://github.com/facebook/react-native" target="_blank" rel="noopener">react-native</a></li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-2fv16nn”}<a href="https://github.com/flutter/flutter" target="_blank" rel="noopener">flutter</a><br>{: }<br>{: id=”20210222104133-po8ky2r”}</li>
</ul>
<p>但是Flutter是在18年底才发行了以第一个稳定版，而React Native是15年就已经推出。这么一看，Flutter突然🔥起来，就1年的时间就挤掉了RN的大半市场，今天我们一起看一下，这两个跨平台的框架究竟有什么神奇的地方。<br>{: id=”20210222104133-n1iwfo5”}</p>
<hr>
<h2 id="1-React-Native的入门与实践"><a href="#1-React-Native的入门与实践" class="headerlink" title="1. React Native的入门与实践"></a>1. React Native的入门与实践</h2><p>{: id=”20210222104133-qmbawdb”}</p>
<p>React Native是带着React的光环出生的一个跨平台框架，具备React的一切新特性，让从Ionic与HBuilder的时代走过的Hybrid的开发欲罢不能。因为他能通过React的代码与通用的业务逻辑，编写一套完全原生的App应用，而且APP的使用感受与OC/JAVA编写的Native APP完全一致。<br>{: id=”20210222104133-fpen8ww”}</p>
<h3 id="1-搭建环境"><a href="#1-搭建环境" class="headerlink" title="1. 搭建环境"></a>1. 搭建环境</h3><p>{: id=”20210222104133-2etulo4”}</p>
<ul>
<li>{: id=”20210222104133-c5rlyvb”}node</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-3nzawpt”}watchman: 监视文件并且记录文件的改动情况。</li>
</ul>
<p>{: }</p>
<ul>
<li><p>{: id=”20210222104133-p9zwus0”}Android环境：</p>
<ul>
<li>{: id=”20210222104133-zo4pf7p”}JDK</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-m9dp8vz”}Android Studio → Android SDK/Gradle/Android SDK Build-Tools<br>{: }<br>{: id=”20210222104133-2qim9mh”}</li>
</ul>
</li>
</ul>
<p>{: }</p>
<ul>
<li><p>{: id=”20210222104133-b2iu4x1”}IOS环境:</p>
<ul>
<li>{: id=”20210222104133-cyqix2m”}Xcode</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-0vt9ai5”}CocoaPods<br>{: }<br>{: id=”20210222104133-774btka”}<br>{: }<br>{: id=”20210222104133-bycevne”}</li>
</ul>
</li>
</ul>
<h3 id="2-创建应用"><a href="#2-创建应用" class="headerlink" title="2. 创建应用"></a>2. 创建应用</h3><p>{: id=”20210222104133-rf7i7rx”}</p>
<p><code>react-native init demo</code><br>{: id=”20210222104133-lmmaw6p”}</p>
<h3 id="3-写法与代码结构"><a href="#3-写法与代码结构" class="headerlink" title="3. 写法与代码结构"></a>3. 写法与代码结构</h3><p>{: id=”20210222104133-t1umqff”}</p>
<p>React Native和React的基本业务逻辑与项目结构是相通的，除了组件是从react-native的包里引用，样式是css的子集，其他的都是页面的生命周期，渲染逻辑，diff都与React无异。<br>{: id=”20210222104133-qk99q5r”}</p>
<p><a href="http://git.innotechx.com/projects/X/repos/mms-rn/browse" target="_blank" rel="noopener">萌推商家APP代码</a><br>{: id=”20210222104133-2366wez”}</p>
<p>Android/IOS目录分别承载这各自应用架构与bundle入口，src部分会打包成jsbundle，然后通过Native的入口注入。<br>{: id=”20210222104133-kuwzkho”}</p>
<ul>
<li>{: id=”20210222104133-7oh97i4”}打开AS与Xcode查看一下对应平台代码<br>{: }<br>{: id=”20210222104133-99nvlod”}</li>
</ul>
<h3 id="4-RN的运行机制"><a href="#4-RN的运行机制" class="headerlink" title="4.RN的运行机制"></a>4.RN的运行机制</h3><p>{: id=”20210222104133-ban0d2x”}</p>
<p>看到这里会有这样的一个疑问<code>为什么js代码可以运行在APP中？</code><br>{: id=”20210222104133-aros6bw”}</p>
<blockquote>
<p>是因为RN有两个核心<br>{: id=”20210222104133-llgngfk”}<br>{: id=”20210222104133-ba6xhrh”}</p>
</blockquote>
<ul>
<li>{: id=”20210222104133-yb70cuj”}JSC引擎：1 → 因为RN的包里一个有JS执行引擎（WebKit的内核JavaScriptCore），所以它可以运行js代码。（前期是JSC的环境，在0.60.x之后添加了Hermes作为js引擎）。<br>{: }<br>{: id=”20210222104133-9bbrrm6”}</li>
</ul>
<blockquote>
</blockquote>
<p>{: id=”20210222104133-wtbtb23”}</p>
<p><a href="https://cloud.tencent.com/developer/article/1492194" target="_blank" rel="noopener">干货 | 加载速度提升15%，携程对RN新一代JS引擎Hermes的调研</a><br>{: id=”20210222104133-6fs9dt1”}</p>
<blockquote>
</blockquote>
<p>{: id=”20210222104133-6iq0lk3”}</p>
<p><a href="https://sourcegraph.com/github.com/facebook/react-native@0.30-stable/-/blob/ReactCommon/cxxreact/JSCExecutor.cpp#L24:11" target="_blank" rel="noopener">React Native JSC源码</a><br>{: id=”20210222104133-c5w1700”}</p>
<blockquote>
</blockquote>
<p>{: id=”20210222104133-l2xudxb”}</p>
<ul>
<li>{: id=”20210222104133-g3kidks”}JSI通信：其实就是JSBridge，作为JS与Native的桥梁，运行在JSC环境下，通过C++实现的Native类的代理对象，这样就可以实现JS与Native通信。<br>{: }<br>{: id=”20210222104133-yysw1t4”}</li>
</ul>
<p>所以：JSC/Hermes会将作为JS的运行环境（解释器），JS层通过JSI获取到对应的C++层的module对象的代理，最终通过JNI回调Java层的module，在通过JNI映射到Native的函数。<br>{: id=”20210222104133-nefozd9”}</p>
<p><a href="https://sourcegraph.com/github.com/facebook/react-native@v0.63.0-rc.1/-/tree/ReactAndroid/src/main/java/com/facebook/react/views/text" target="_blank" rel="noopener">RN Native Android Module源码</a><br>{: id=”20210222104133-sspbq0q”}</p>
<p><a href="https://sourcegraph.com/github.com/facebook/react-native@v0.63.0-rc.1/-/blob/React/Views/RCTView.m" target="_blank" rel="noopener">RN Native IOS Module源码</a><br>{: id=”20210222104133-pu6jdob”}</p>
<p>所以，RN中所有的标签其实都不是真是的控件，js代码中所有的控件，都是一个“Map对中的key”，JS通过这个key组合的DOM，放到VDOM的js数据结构中，然后通过JSBridge代理到Native，Native端会解析这个DOM，从而获得对应的Native的控件。<br>{: id=”20210222104133-3uoykgp”}</p>
<h3 id="5-怎么实现一个Native-Bridge的功能。（先不讲）"><a href="#5-怎么实现一个Native-Bridge的功能。（先不讲）" class="headerlink" title="5.怎么实现一个Native Bridge的功能。（先不讲）"></a>5.怎么实现一个Native Bridge的功能。（先不讲）</h3><p>{: id=”20210222104133-tzqhldk”}</p>
<blockquote>
<p>例子：实现判断应用是否开启通知，如果未打开通知则进入设置页面开启通知。<br>{: id=”20210222104133-u8sd7oo”}<br>{: id=”20210222104133-ogn4mv8”}</p>
</blockquote>
<p>5.1 <code>IOS端</code><br>{: id=”20210222104133-ye5co9z”}</p>
<ul>
<li>{: id=”20210222104133-bxel7us”}IOS在 React Native 中，一个“原生模块”就是一个实现了“RCTBridgeModule”协议的 Objective-C 类。<br>{: }<br>{: id=”20210222104133-gw2u8xp”}</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line">#import &lt;React&#x2F;RCTEventEmitter.h&gt;</span><br><span class="line"></span><br><span class="line">@interface RNDataTransferManager : RCTEventEmitter &lt;RCTBridgeModule&gt;</span><br><span class="line"></span><br><span class="line">@end</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-1rmpcl1”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#import &quot;RNDataTransferManager.h&quot;</span><br><span class="line"></span><br><span class="line">@implementation RNDataTransferManager</span><br><span class="line"></span><br><span class="line">RCT_EXPORT_MODULE();</span><br><span class="line">&#x2F;&#x2F; 判断notification是否开启</span><br><span class="line">RCT_EXPORT_METHOD(isNotificationEnabled:(RCTPromiseResolveBlock)resolve</span><br><span class="line">                  rejecter:(RCTPromiseRejectBlock)reject) &#123;</span><br><span class="line">  BOOL isEnable &#x3D; NO;</span><br><span class="line">  UIUserNotificationSettings *setting &#x3D; [[UIApplication sharedApplication] currentUserNotificationSettings];</span><br><span class="line">  isEnable &#x3D; (UIUserNotificationTypeNone &#x3D;&#x3D; setting.types) ? NO : YES;</span><br><span class="line">  return resolve(@(isEnable));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 进入设置开启Notification</span><br><span class="line">RCT_EXPORT_METHOD(gotoOpenNotification) &#123;</span><br><span class="line">  [self goToAppSystemSetting];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-j9y5te7”}</p>
<p>注意两个宏：<br>{: id=”20210222104133-4uwy6vw”}</p>
<p><code>RCT_EXPORT_METHOD</code>：用来设置给JS导出的Native Module名字。<br>{: id=”20210222104133-rlygl0e”}</p>
<p><code>RCT_EXPORT_MODULE</code>：给JS提供的方法通过<code>RCT_EXPORT_METHOD()</code>宏实现，必须明确的声明要给 JavaScript 导出的方法，否则 React Native 不会导出任何方法。<br>{: id=”20210222104133-jjcq3if”}</p>
<p>5.2 <code>Android端</code><br>{: id=”20210222104133-a4iiz40”}</p>
<p>首先新建一个JavaModule类继承ReactContextBaseJavaModule。<br>{: id=”20210222104133-8cr3xel”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">public class RNDataTransferManager extends ReactContextBaseJavaModule &#123;</span><br><span class="line"></span><br><span class="line">    private static ReactApplicationContext reactContext;</span><br><span class="line"></span><br><span class="line">    public static RNDataTransferManager rnDataTransferManager;</span><br><span class="line"></span><br><span class="line">    public static String currentBindAlias &#x3D; &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    public RNDataTransferManager(@Nonnull ReactApplicationContext reactContext) &#123;</span><br><span class="line">        super(reactContext);</span><br><span class="line">        this.reactContext &#x3D; reactContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static RNDataTransferManager getInstance() &#123;</span><br><span class="line">        if (null &#x3D;&#x3D; rnDataTransferManager) &#123;</span><br><span class="line">            rnDataTransferManager &#x3D; new RNDataTransferManager(reactContext);</span><br><span class="line">        &#125;</span><br><span class="line">        return rnDataTransferManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Nonnull</span><br><span class="line">    @Override</span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return &quot;RNDataTransferManager&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">        @ReactMethod</span><br><span class="line">    public void isNotificationEnabled(Promise promise) &#123;</span><br><span class="line">        if (promise !&#x3D; null) &#123;</span><br><span class="line">            if (MainApplication.getContext() !&#x3D; null) &#123;</span><br><span class="line">                if (NotificationManagerCompat.from(MainApplication.getContext())</span><br><span class="line">                        .areNotificationsEnabled()) &#123;</span><br><span class="line">                    Log.e(&quot;push&quot;, &quot;推送开启 isNotificationEnabled -&gt; true&quot;);</span><br><span class="line">                    promise.resolve(true);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    Log.e(&quot;push&quot;, &quot;推送未开启 isNotificationEnabled -&gt; false&quot;);</span><br><span class="line">                    promise.resolve(false);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                promise.resolve(false);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ReactMethod</span><br><span class="line">    public boolean gotoOpenNotification() &#123;</span><br><span class="line">        if (MainApplication.getContext() &#x3D;&#x3D; null) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        Intent intent &#x3D; getSetIntent(MainApplication.getContext());</span><br><span class="line">        PackageManager packageManager &#x3D; MainApplication.getContext().getPackageManager();</span><br><span class="line">        List&lt;ResolveInfo&gt; list &#x3D; packageManager.queryIntentActivities(intent, 0);</span><br><span class="line">        if (list !&#x3D; null &amp;&amp; list.size() &gt; 0) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                MainApplication.getContext().startActivity(intent);</span><br><span class="line">                return true;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-rm3c559”}</p>
<p>写好了Native Module之后需要注册模块。<br>{: id=”20210222104133-urtpiv8”}</p>
<p>1）首先通过ReactPackage的createNativeModules来注册模块。<br>{: id=”20210222104133-0ekolib”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package com.mengtuiapp.mms.bridge;</span><br><span class="line"></span><br><span class="line">import com.facebook.react.ReactPackage;</span><br><span class="line">import com.facebook.react.bridge.NativeModule;</span><br><span class="line">import com.facebook.react.bridge.ReactApplicationContext;</span><br><span class="line">import com.facebook.react.uimanager.ViewManager;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Nonnull;</span><br><span class="line"></span><br><span class="line">public class DataTransferPackage implements ReactPackage &#123;</span><br><span class="line"></span><br><span class="line">    private RNDataTransferManager transferModule;</span><br><span class="line"></span><br><span class="line">    @Nonnull</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;NativeModule&gt; createNativeModules(@Nonnull ReactApplicationContext reactContext) &#123;</span><br><span class="line">        List&lt;NativeModule&gt; nativeModules &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        transferModule &#x3D; new RNDataTransferManager(reactContext);</span><br><span class="line">        RNDataTransferManager.rnDataTransferManager &#x3D; transferModule;</span><br><span class="line">        nativeModules.add(transferModule);</span><br><span class="line">        return nativeModules;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Nonnull</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;ViewManager&gt; createViewManagers(@Nonnull ReactApplicationContext reactContext) &#123;</span><br><span class="line">        return Collections.emptyList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-4h7wqzg”}</p>
<p>2）然后让你的应用拿到注册到的package，需要在Application的getPackages方法中提供。<br>{: id=”20210222104133-l5emlhb”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected List&lt;ReactPackage&gt; getPackages() &#123;</span><br><span class="line">                 List&lt;ReactPackage&gt; packages &#x3D; new PackageList(this).getPackages();</span><br><span class="line">                 packages.add(new DataTransferPackage());</span><br><span class="line">                 packages.add(new RNInstallApkPackage());</span><br><span class="line">                 packages.add(new RNUserAgentPackage());</span><br><span class="line">                 packages.add(new RNKeyboardAdjustPackage());</span><br><span class="line">                 packages.add(new CodePush(mContext.getString(R.string.InnotechCodepushKey), mContext, this.moduleId, BuildConfig.DEBUG, mContext.getString(R.string.InnotechCodepushServerUrl)));</span><br><span class="line">                 return packages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-cjbt4kf”}</p>
<p>5.3 JS端调用<br>{: id=”20210222104133-8jv49wg”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">NativeModules.RNDataTransferManager.gotoOpenNotification()</span><br><span class="line">就可以前往应用设置页面打开通知。</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-rlailts”}</p>
<ul>
<li>{: id=”20210222104133-ayptlrs”}当然我们实际开发中不会围绕这么多Native Module来做文章，但是可以看出，做RN是需要一个基本的原生的操作能力。<br>{: }<br>{: id=”20210222104133-n20r94d”}</li>
</ul>
<h3 id="6-这样做的优势和问题"><a href="#6-这样做的优势和问题" class="headerlink" title="6. 这样做的优势和问题"></a>6. 这样做的优势和问题</h3><p>{: id=”20210222104133-ubbu74e”}</p>
<h4 id="优势："><a href="#优势：" class="headerlink" title="优势："></a>优势：</h4><p>{: id=”20210222104133-cwkql84”}</p>
<blockquote>
<ul>
<li>{: id=”20210222104133-f8quat9”}相比Hybrid性能更高、因为都是原生组件的渲染。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-vmjl31z”}从render到virtual dom的过程都是React驱动，具备React的一切优秀特性，可以使用React的社区优秀工具。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-w1k9pbe”}项目搭建起来了，用JS写APP又具有原生的渲染效率简直爽，一份代码Android、IOS、web都可以适配（毕竟vDom层是一样的，jsbridge就随你魔改了）。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-5uugv2s”}相比原生的编译速度，开发JS使用HotReload简直太爽了。<br>{: }<br>{: id=”20210222104133-67ji6p4”}<br>{: id=”20210222104133-fxr34wq”}</li>
</ul>
</blockquote>
<h4 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h4><p>{: id=”20210222104133-phigl88”}</p>
<blockquote>
<ul>
<li>{: id=”20210222104133-tus16du”}跨平台，但是Android、IOS毕竟是不同的系统与生态，组件与功能都有一些跨平台的差异，RN的原生组件的平台差异性很大。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-hupaaar”}性能问题：动画性能不好、列表数据量大性能不好，主要集中在低端机，大数据列表快速滑动会有白屏，动画层级多在Android低于30fps的情况频繁。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-eljmcwl”}白屏问题，加载bundle的时间会有一个白屏出现，需要手动改Native代码。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-z5lbgyx”}开发业务功能不需要原生能力，但是开发一个完整的跨平台项目，是需要具备一定的双端原生能力（有很多要写Native的，许多功能和组件也需要自己封装）</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-vslwv3k”}这也是RN做的不好的地方，版本迭代太慢，不痛不痒的迭代了5年了，很多问题还是没有解决。这也是Flutter为什么这么火的原因。<br>{: }<br>{: id=”20210222104133-c7of079”}<br>{: id=”20210222104133-bx031vc”}</li>
</ul>
</blockquote>
<h3 id="7-那么Flutter怎么做的"><a href="#7-那么Flutter怎么做的" class="headerlink" title="7. 那么Flutter怎么做的"></a>7. 那么Flutter怎么做的</h3><p>{: id=”20210222104133-x5xquq1”}</p>
<p>Flutter使用Dart作为开发语言，作为一个AOT框架，Flutter是在运行时直接将Dart转化成客户端的可执行文件，然后通过Skia渲染引擎直接渲染到硬件平台。如果说RN是为开发者做了平台兼容，那Flutter更像是为开发者屏蔽了平台的概念。RN需要被转译为本地对应的组件，而Flutter是直接编译成可执行文件并渲染到设备。Flutter可以直接控制屏幕上的每一个像素，这样就可以避免由于使用JSBridge导致的性能问题。<br>{: id=”20210222104133-c2l5jin”}</p>
<blockquote>
</blockquote>
<p>{: id=”20210222104133-p1bb2ns”}</p>
<p>三要素：<br>{: id=”20210222104133-houvs8o”}</p>
<blockquote>
</blockquote>
<p>{: id=”20210222104133-kx4acd3”}</p>
<ul>
<li>{: id=”20210222104133-0p1xxtn”}Dart语言开发。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-khvjn7e”}任何Dart代码都是AOT运行前编译成本地可执行文件，使用Skia（渲染引擎）直接渲染到本机。</li>
</ul>
<p>{: }</p>
<ul>
<li>{: id=”20210222104133-tgic1so”}不使用原生的组件，具有自己的widget库，开发时构建自己的widget树来画页面。<br>{: }<br>{: id=”20210222104133-p8itotk”}</li>
</ul>
<h5 id="如果是页面级的应用来说，Flutter是不需要任何原生代码来写组件，所有组件和页面都可以通过Flutter直接写好。"><a href="#如果是页面级的应用来说，Flutter是不需要任何原生代码来写组件，所有组件和页面都可以通过Flutter直接写好。" class="headerlink" title="如果是页面级的应用来说，Flutter是不需要任何原生代码来写组件，所有组件和页面都可以通过Flutter直接写好。"></a>如果是页面级的应用来说，Flutter是不需要任何原生代码来写组件，所有组件和页面都可以通过Flutter直接写好。</h5><p>{: id=”20210222104133-t2ljnmt”}</p>
<h4 id="7-1-Flutter代码结构"><a href="#7-1-Flutter代码结构" class="headerlink" title="7.1 Flutter代码结构"></a>7.1 Flutter代码结构</h4><p>{: id=”20210222104133-owqc5q0”}</p>
<p><a href="https://gitlab.innotechx.com/xuanjiawei/flutter_mms_app" target="_blank" rel="noopener">萌推商家APP Flutter版本</a><br>{: id=”20210222104133-t4uct64”}</p>
<h4 id="7-2-Flutter运行与调试"><a href="#7-2-Flutter运行与调试" class="headerlink" title="7.2 Flutter运行与调试"></a>7.2 Flutter运行与调试</h4><p>{: id=”20210222104133-rhtghgg”}</p>
<p>直接演示。<br>{: id=”20210222104133-pdrdme2”}</p>
<h3 id="8-总结"><a href="#8-总结" class="headerlink" title="8. 总结"></a>8. 总结</h3><p>{: id=”20210222104133-ksvlir7”}</p>
<p>今天我们主要看了一下两个框架开发时的代码结构，与代码书写形式，还有简单了解了一下它是怎么运行。那之后如果小伙伴想继续去学习，或做一个自己的应用，还有以下几个方面需要注意：<br>{: id=”20210222104133-6h5ncbr”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. APP初始化与生命周期状态。</span><br><span class="line">2. 数据持久化 - 数据管理、SP、本地数据库。</span><br><span class="line">3. 碎片化处理。</span><br><span class="line">4. 打包三要素：Android（混淆、签名、加固），IOS（生成证书、导入证书、使用证书）。</span><br><span class="line">5. 拆包、热更新、原生集成。</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-s9mpdpa”}</p>
<p>Flutter因为自带了渲染引擎，理论上是要比RN渲染效率要高，但是其实实际使用上，在性能过剩的移动端设备中，并没有出现特别大的差异，而Facebook的团队在Flutter的持续施压之下也决定重构底层，并在最近几个版本有了一些进步，所以大家有兴趣的都可以研究一下。<br>{: id=”20210222104133-g0zzgub”}</p>
<p>{: id=”20210222104133-qfrq2ko” type=”doc”}</p>

	
	</div>
  <a type="button" href="/2020/05/28/跨平台开发指北/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/08/15/mobx/" >mobx使用指北</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-08-15  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>{: id=”20210222104133-9w9tjkh”}</p>
<p><strong>MobX 是一个经过战火洗礼的库，它通过透明的函数响应式编程(transparently applying functional reactive programming - TFRP)使得状态管理变得简单和可扩展。</strong><br>{: id=”20210222104133-obmlnd9”}</p>
<p>MobX 背后的哲学很简单：<strong>任何源自应用状态的东西都应该自动地获得。</strong><br>{: id=”20210222104133-fnrw2df”}</p>
<p>其中包括 UI、数据序列化、服务器通讯，等等。<br>{: id=”20210222104133-r4ynmwc”}</p>
<p>React 和 MobX 是一对强力组合。React 通过提供机制把应用状态转换为可渲染组件树并对其进行渲染。而 MobX 提供机制来存储和更新应用状态供 React 使用。<br>{: id=”20210222104133-8wf4eoy”}</p>
<p>对于应用开发中的常见问题，React 和 MobX 都提供了最优和独特的解决方案。React 提供了优化 UI 渲染的机制， 这种机制就是通过使用虚拟 DOM 来减少昂贵的 DOM 变化的数量。MobX 提供了优化应用状态与 React 组件同步的机制，这种机制就是使用响应式虚拟依赖状态图表，它只有在真正需要的时候才更新并且永远保持是最新的。<br>{: id=”20210222104133-6ovxox5”}</p>
<h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><p>{: id=”20210222104133-061ea4l”}</p>
<h4 id="1-Observable-state-可观察的状态"><a href="#1-Observable-state-可观察的状态" class="headerlink" title="1. Observable state(可观察的状态)"></a>1. Observable state(可观察的状态)<br></h4><p>{: id=”20210222104133-hltprkg”}</p>
<p>MobX 为现有的数据结构(如对象，数组和类实例)添加了可观察的功能。 通过使用 @observable 装饰器(ES.Next)来给你的类属性添加注解就可以简单地完成这一切。<br>{: id=”20210222104133-vyaix0y”}</p>
<h4 id="2-Computed-value-计算值"><a href="#2-Computed-value-计算值" class="headerlink" title="2. Computed value(计算值)"></a>2. Computed value(计算值)</h4><p>{: id=”20210222104133-cl006km”}</p>
<p>使用 MobX， 你可以定义在相关数据发生变化时自动更新的值。<br>{: id=”20210222104133-e2dxw44”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class TodoList &#123;</span><br><span class="line">    @observable todos &#x3D; [];</span><br><span class="line">    @computed get unfinishedTodoCount() &#123;</span><br><span class="line">        return this.todos.filter(todo &#x3D;&gt; !todo.finished).length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-ooxdecf”}</p>
<p>当添加了一个新的 todo 或者某个 todo 的 finished 属性发生变化时，MobX 会确保 unfinishedTodoCount 自动更新。 像这样的计算可以类似于 MS Excel 这样电子表格程序中的公式。每当只有在需要它们的时候，它们才会自动更新。<br>{: id=”20210222104133-crlrzyf”}</p>
<h4 id="3-Reactions-反应"><a href="#3-Reactions-反应" class="headerlink" title="3. Reactions(反应)"></a>3. Reactions(反应)</h4><p>{: id=”20210222104133-3t140e3”}</p>
<p>Reactions 和计算值很像，但它不是产生一个新的值，而是会产生一些副作用，比如打印到控制台、网络请求、递增地更新 React 组件树以修补 DOM、等等。<br>{: id=”20210222104133-4ek2rbe”}</p>
<h5 id="React"><a href="#React" class="headerlink" title="React"></a>React</h5><p>{: id=”20210222104133-wu06r54”}</p>
<p>如果你用 React 的话，可以把你的(无状态函数)组件变成响应式组件，方法是在组件上添加 observer 函数/ 装饰器. observer 由 mobx-react 包提供的。<br>{: id=”20210222104133-1nar0cu”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123;Component&#125; from &#39;react&#39;;</span><br><span class="line">import ReactDOM from &#39;react-dom&#39;;</span><br><span class="line">import &#123;observer&#125; from &#39;mobx-react&#39;;</span><br><span class="line"></span><br><span class="line">@observer</span><br><span class="line">class TodoListView extends Component &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return &lt;div&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">                &#123;this.props.todoList.todos.map(todo &#x3D;&gt;</span><br><span class="line">                    &lt;TodoView todo&#x3D;&#123;todo&#125; key&#x3D;&#123;todo.id&#125; &#x2F;&gt;</span><br><span class="line">                )&#125;</span><br><span class="line">            &lt;&#x2F;ul&gt;</span><br><span class="line">            Tasks left: &#123;this.props.todoList.unfinishedTodoCount&#125;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const TodoView &#x3D; observer((&#123;todo&#125;) &#x3D;&gt;</span><br><span class="line">    &lt;li&gt;</span><br><span class="line">        &lt;input</span><br><span class="line">            type&#x3D;&quot;checkbox&quot;</span><br><span class="line">            checked&#x3D;&#123;todo.finished&#125;</span><br><span class="line">            onClick&#x3D;&#123;() &#x3D;&gt; todo.finished &#x3D; !todo.finished&#125;</span><br><span class="line">        &#x2F;&gt;&#123;todo.title&#125;</span><br><span class="line">    &lt;&#x2F;li&gt;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const store &#x3D; new TodoList();</span><br><span class="line">ReactDOM.render(&lt;TodoListView todoList&#x3D;&#123;store&#125; &#x2F;&gt;, document.getElementById(&#39;mount&#39;));</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-qm4tkdw”}</p>
<h5 id="自定义-reactions"><a href="#自定义-reactions" class="headerlink" title="自定义 reactions"></a>自定义 reactions</h5><p>{: id=”20210222104133-nja470c”}</p>
<p>使用 autorun、reaction 和 when 函数即可简单的创建自定义 reactions，以满足你的具体场景。<br>{: id=”20210222104133-mis2oli”}</p>
<p>例如，每当 unfinishedTodoCount 的数量发生变化时，下面的 autorun 会打印日志消息:<br>{: id=”20210222104133-37eftwj”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">autorun(() &#x3D;&gt; &#123;</span><br><span class="line">    console.log(&quot;Tasks left: &quot; + todos.unfinishedTodoCount)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-qxjhyr1”}</p>
<h4 id="Actions-动作"><a href="#Actions-动作" class="headerlink" title="Actions(动作)"></a>Actions(动作)</h4><p>{: id=”20210222104133-ddkq7nk”}</p>
<p>不同于 flux 系的一些框架，MobX 对于如何处理用户事件是完全开明的。<br>{: id=”20210222104133-vmnqtjp”}</p>
<p>可以用类似 Flux 的方式完成<br>或者使用 RxJS 来处理事件<br>或者用最直观、最简单的方式来处理事件，正如上面演示所用的 onClick<br>最后全部归纳为: 状态应该以某种方式来更新。<br>{: id=”20210222104133-kcomvnc”}</p>
<p>当状态更新后，MobX 会以一种高效且无障碍的方式处理好剩下的事情。像下面如此简单的语句，已经足够用来自动更新用户界面了。<br>{: id=”20210222104133-lprt8b8”}</p>
<p>从技术上层面来讲，并不需要触发事件、调用分派程序或者类似的工作。归根究底 React 组件只是状态的华丽展示，而状态的衍生由 MobX 来管理。<br>{: id=”20210222104133-yt25tfi”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">store.todos.push(</span><br><span class="line">    new Todo(&quot;Get Coffee&quot;),</span><br><span class="line">    new Todo(&quot;Write simpler code&quot;)</span><br><span class="line">);</span><br><span class="line">store.todos[0].finished &#x3D; true;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-83fk1ky”}</p>
<p>{: id=”20210222104133-kz7ivhz” type=”doc”}</p>

	
	</div>
  <a type="button" href="/2019/08/15/mobx/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/07/25/装饰器/" >装饰器 Decorator</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-07-25  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>{: id=”20210222104133-dmcv0uf”}</p>
<h2 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h2><p>{: id=”20210222104133-y79ecdy”}</p>
<p>装饰器是一种函数，写成@ + 函数名。它可以放在类和类方法的定义前面。<br>{: id=”20210222104133-exj499d”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@frozen class Foo &#123;</span><br><span class="line">  @configurable(false)</span><br><span class="line">  @enumerable(true)</span><br><span class="line">  method() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  @throttle(500)</span><br><span class="line">  expensiveMethod() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-k014x6c”}</p>
<p>上面代码一共使用了四个装饰器，一个用在类本身，另外三个用在类方法。它们不仅增加了代码的可读性，清晰地表达了意图，而且提供一种方便的手段，增加或修改类的功能。<br>{: id=”20210222104133-ocucy89”}</p>
<h3 id="1-类的装饰"><a href="#1-类的装饰" class="headerlink" title="1. 类的装饰"></a>1. 类的装饰</h3><p>{: id=”20210222104133-81pbixm”}</p>
<p>装饰器可以用来装饰整个类。<br>{: id=”20210222104133-1utkqoq”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@testable</span><br><span class="line">class MyTestableClass &#123;</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function testable(target) &#123;</span><br><span class="line">  target.isTestable &#x3D; true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyTestableClass.isTestable &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-nj2jzx2”}</p>
<p>基本上，装饰器的行为就是下面这样。<br>{: id=”20210222104133-2ss9som”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@decorator</span><br><span class="line">class A &#123;&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 等同于</span><br><span class="line"></span><br><span class="line">class A &#123;&#125;</span><br><span class="line">A &#x3D; decorator(A) || A;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-8x7h3v8”}</p>
<p>也就是说，装饰器是一个对类进行处理的函数。装饰器函数的第一个参数，就是所要装饰的目标类。<br>{: id=”20210222104133-frgqhri”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function testable(target) &#123;</span><br><span class="line">  &#x2F;&#x2F; ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-0bltlry”}</p>
<p>上面代码中，testable 函数的参数 target，就是会被装饰的类。<br>{: id=”20210222104133-jy0h12w”}</p>
<p>如果觉得一个参数不够用，可以在装饰器外面再封装一层函数。<br>{: id=”20210222104133-a0x91ah”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function testable(isTestable) &#123;</span><br><span class="line">  return function(target) &#123;</span><br><span class="line">    target.isTestable &#x3D; isTestable;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@testable(true)</span><br><span class="line">class MyTestableClass &#123;&#125;</span><br><span class="line">MyTestableClass.isTestable &#x2F;&#x2F; true</span><br><span class="line"></span><br><span class="line">@testable(false)</span><br><span class="line">class MyClass &#123;&#125;</span><br><span class="line">MyClass.isTestable &#x2F;&#x2F; false</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-v6jnmae”}</p>
<p>上面代码中，装饰器 testable 可以接受参数，这就等于可以修改装饰器的行为。<br>{: id=”20210222104133-buzosg8”}</p>
<p>注意，装饰器对类的行为的改变，是代码编译时发生的，而不是在运行时。这意味着，装饰器能在编译阶段运行代码。也就是说，装饰器本质就是编译时执行的函数。<br>{: id=”20210222104133-03zn20u”}</p>
<p>前面的例子是为类添加一个静态属性，如果想添加实例属性，可以通过目标类的 prototype 对象操作。<br>{: id=”20210222104133-ggzaamw”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function testable(target) &#123;</span><br><span class="line">  target.prototype.isTestable &#x3D; true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@testable</span><br><span class="line">class MyTestableClass &#123;&#125;</span><br><span class="line"></span><br><span class="line">let obj &#x3D; new MyTestableClass();</span><br><span class="line">obj.isTestable &#x2F;&#x2F; true</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-agyeghv”}</p>
<p>上面代码中，装饰器函数 testable 是在目标类的 prototype 对象上添加属性，因此就可以在实例上调用。<br>{: id=”20210222104133-4o70hdb”}</p>
<h3 id="2-方法的装饰"><a href="#2-方法的装饰" class="headerlink" title="2.方法的装饰"></a>2.方法的装饰</h3><p>{: id=”20210222104133-4cd0rtv”}</p>
<p>装饰器不仅可以装饰类，还可以装饰类的属性。<br>{: id=”20210222104133-s6h85cg”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  @readonly</span><br><span class="line">  name() &#123; return &#96;$&#123;this.first&#125; $&#123;this.last&#125;&#96; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-bxa30wy”}</p>
<p>上面代码中，装饰器 readonly 用来装饰“类”的 name 方法。<br>{: id=”20210222104133-2tc7o0y”}</p>
<p>装饰器函数 readonly 一共可以接受三个参数。<br>{: id=”20210222104133-t2j12b8”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function readonly(target, name, descriptor)&#123;</span><br><span class="line">  &#x2F;&#x2F; descriptor对象原来的值如下</span><br><span class="line">  &#x2F;&#x2F; &#123;</span><br><span class="line">  &#x2F;&#x2F;   value: specifiedFunction,</span><br><span class="line">  &#x2F;&#x2F;   enumerable: false,</span><br><span class="line">  &#x2F;&#x2F;   configurable: true,</span><br><span class="line">  &#x2F;&#x2F;   writable: true</span><br><span class="line">  &#x2F;&#x2F; &#125;;</span><br><span class="line">  descriptor.writable &#x3D; false;</span><br><span class="line">  return descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readonly(Person.prototype, &#39;name&#39;, descriptor);</span><br><span class="line">&#x2F;&#x2F; 类似于</span><br><span class="line">Object.defineProperty(Person.prototype, &#39;name&#39;, descriptor);</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-t5l39dw”}</p>
<p>装饰器第一个参数是类的原型对象，上例是 Person.prototype，装饰器的本意是要“装饰”类的实例，但是这个时候实例还没生成，所以只能去装饰原型（这不同于类的装饰，那种情况时 target 参数指的是类本身）；第二个参数是所要装饰的属性名，第三个参数是该属性的描述对象。<br>{: id=”20210222104133-uuhan72”}</p>
<p>另外，上面代码说明，装饰器（readonly）会修改属性的描述对象（descriptor），然后被修改的描述对象再用来定义属性。<br>{: id=”20210222104133-wve043j”}</p>
<p>下面是另一个例子，修改属性描述对象的 enumerable 属性，使得该属性不可遍历。<br>{: id=”20210222104133-w7i4ok5”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  @nonenumerable</span><br><span class="line">  get kidCount() &#123; return this.children.length; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function nonenumerable(target, name, descriptor) &#123;</span><br><span class="line">  descriptor.enumerable &#x3D; false;</span><br><span class="line">  return descriptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-ys6sg3c”}</p>
<p>下面的@log 装饰器，可以起到输出日志的作用。<br>{: id=”20210222104133-3bqcadd”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class Math &#123;</span><br><span class="line">  @log</span><br><span class="line">  add(a, b) &#123;</span><br><span class="line">    return a + b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function log(target, name, descriptor) &#123;</span><br><span class="line">  var oldValue &#x3D; descriptor.value;</span><br><span class="line"></span><br><span class="line">  descriptor.value &#x3D; function() &#123;</span><br><span class="line">    console.log(&#96;Calling $&#123;name&#125; with&#96;, arguments);</span><br><span class="line">    return oldValue.apply(this, arguments);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const math &#x3D; new Math();</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; passed parameters should get logged now</span><br><span class="line">math.add(2, 4);</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-l0f013l”}</p>
<p>上面代码中，@log 装饰器的作用就是在执行原始的操作之前，执行一次 console.log，从而达到输出日志的目的。<br>{: id=”20210222104133-i1zmu06”}</p>
<p>装饰器有注释的作用。<br>{: id=”20210222104133-eo2r3p8”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@testable</span><br><span class="line">class Person &#123;</span><br><span class="line">  @readonly</span><br><span class="line">  @nonenumerable</span><br><span class="line">  name() &#123; return &#96;$&#123;this.first&#125; $&#123;this.last&#125;&#96; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-f8wq81z”}</p>
<p>从上面代码中，我们一眼就能看出，Person 类是可测试的，而 name 方法是只读和不可枚举的。<br>{: id=”20210222104133-ez6obv9”}</p>
<p>下面是使用 Decorator 写法的组件，看上去一目了然。<br>{: id=”20210222104133-m91kjc5”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Component(&#123;</span><br><span class="line">  tag: &#39;my-component&#39;,</span><br><span class="line">  styleUrl: &#39;my-component.scss&#39;</span><br><span class="line">&#125;)</span><br><span class="line">export class MyComponent &#123;</span><br><span class="line">  @Prop() first: string;</span><br><span class="line">  @Prop() last: string;</span><br><span class="line">  @State() isVisible: boolean &#x3D; true;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;p&gt;Hello, my name is &#123;this.first&#125; &#123;this.last&#125;&lt;&#x2F;p&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-xed5v1l”}</p>
<p>如果同一个方法有多个装饰器，会像剥洋葱一样，先从外到内进入，然后由内向外执行。<br>{: id=”20210222104133-e4plsoz”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function dec(id)&#123;</span><br><span class="line">  console.log(&#39;evaluated&#39;, id);</span><br><span class="line">  return (target, property, descriptor) &#x3D;&gt; console.log(&#39;executed&#39;, id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Example &#123;</span><br><span class="line">    @dec(1)</span><br><span class="line">    @dec(2)</span><br><span class="line">    method()&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; evaluated 1</span><br><span class="line">&#x2F;&#x2F; evaluated 2</span><br><span class="line">&#x2F;&#x2F; executed 2</span><br><span class="line">&#x2F;&#x2F; executed 1</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-5fkp6k9”}</p>
<p>上面代码中，外层装饰器@dec(1)先进入，但是内层装饰器@dec(2)先执行。<br>{: id=”20210222104133-ev4femo”}</p>
<p>除了注释，装饰器还能用来类型检查。所以，对于类来说，这项功能相当有用。从长期来看，它将是 JavaScript 代码静态分析的重要工具。<br>{: id=”20210222104133-5t3aex2”}</p>
<h3 id="3-为什么装饰器不能用于函数？"><a href="#3-为什么装饰器不能用于函数？" class="headerlink" title="3.为什么装饰器不能用于函数？"></a>3.为什么装饰器不能用于函数？</h3><p>{: id=”20210222104133-zahysyi”}</p>
<p>装饰器只能用于类和类的方法，不能用于函数，因为存在函数提升。<br>{: id=”20210222104133-pmb6hwt”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var counter &#x3D; 0;</span><br><span class="line"></span><br><span class="line">var add &#x3D; function () &#123;</span><br><span class="line">  counter++;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@add</span><br><span class="line">function foo() &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-eopotcc”}</p>
<p>上面的代码，意图是执行后 counter 等于 1，但是实际上结果是 counter 等于 0。因为函数提升，使得实际执行的代码是下面这样。<br>{: id=”20210222104133-v3siv3i”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@add</span><br><span class="line">function foo() &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var counter;</span><br><span class="line">var add;</span><br><span class="line"></span><br><span class="line">counter &#x3D; 0;</span><br><span class="line"></span><br><span class="line">add &#x3D; function () &#123;</span><br><span class="line">  counter++;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-i4dugvv”}</p>
<p>如果一定要装饰函数，可以采用高阶函数的形式直接执行。<br>{: id=”20210222104133-mbvvn2d”}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function doSomething(name) &#123;</span><br><span class="line">  console.log(&#39;Hello, &#39; + name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function loggingDecorator(wrapped) &#123;</span><br><span class="line">  return function() &#123;</span><br><span class="line">    console.log(&#39;Starting&#39;);</span><br><span class="line">    const result &#x3D; wrapped.apply(this, arguments);</span><br><span class="line">    console.log(&#39;Finished&#39;);</span><br><span class="line">    return result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const wrapped &#x3D; loggingDecorator(doSomething);</span><br></pre></td></tr></table></figure>
<p>{: id=”20210222104133-bgollah”}</p>
<p>{: id=”20210222104133-pv8llo2” type=”doc”}</p>

	
	</div>
  <a type="button" href="/2019/07/25/装饰器/#more" class="btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
		
			
	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/Javascript/">Javascript<span>1</span></a></li>
		
			<li><a href="/tags/resume/">resume<span>1</span></a></li>
		
			<li><a href="/tags/MobX/">MobX<span>1</span></a></li>
		
			<li><a href="/tags/react-native/">react native<span>1</span></a></li>
		
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2020/07/02/resume/" ><i class="fa fa-file-o"></i>个人简历</a>
      </li>
    
      <li>
        <a href="/2020/06/15/ReactNativeInNative/" ><i class="fa fa-file-o"></i>ReactNative集成到现有原生项目、拆包、热更新</a>
      </li>
    
      <li>
        <a href="/2020/05/28/跨平台开发指北/" ><i class="fa fa-file-o"></i>跨平台开发指北</a>
      </li>
    
      <li>
        <a href="/2019/08/15/mobx/" ><i class="fa fa-file-o"></i>mobx使用指北</a>
      </li>
    
      <li>
        <a href="/2019/07/25/装饰器/" ><i class="fa fa-file-o"></i>装饰器 Decorator</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/wzpan/hexo-theme-freemind" title="Freemind's Github repository." target="_blank"]);">Freemind</a></li>
	
		<li><i class="fa fa-github"></i><a href="https://github.com/kristopolous/BOOTSTRA.386" title="BOOTSTRA.386's Github repository." target="_blank"]);">BOOTSTRA.386</a></li>
	
		<li><i class="fa fa-github"></i><a href="https://github.com/blackshow/hexo-theme-freemind.386" title="Freemind.386's Github repository." target="_blank"]);">Freemind.386</a></li>
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/mifind" title="My Github account." target="_blank"]);">My Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->

	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2021 MIFind
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
